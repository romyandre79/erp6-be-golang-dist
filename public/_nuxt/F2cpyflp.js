import{q as l,aU as n,aM as c}from"#entry";class s extends Error{}s.prototype.name="InvalidTokenError";function u(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,r)=>{let t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function d(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return u(e)}catch{return atob(e)}}function h(o,e){if(typeof o!="string")throw new s("Invalid token specified: must be a string");e||(e={});const r=e.header===!0?0:1,t=o.split(".")[r];if(typeof t!="string")throw new s(`Invalid token specified: missing part #${r+1}`);let a;try{a=d(t)}catch(i){throw new s(`Invalid token specified: invalid base64 for part #${r+1} (${i.message})`)}try{return JSON.parse(a)}catch(i){throw new s(`Invalid token specified: invalid json for part #${r+1} (${i.message})`)}}const k=l("user",{state:()=>({token:null,user:null}),actions:{setAuth(o,e){this.token=o,this.user=e;const r=n("token",{path:"/",maxAge:3600*24*7}),t=n("user",{path:"/",maxAge:3600*24*7});r.value=o,t.value=JSON.stringify(e)},async loadAuth(){const o=n("token"),e=n("user"),r=o.value;if(r)try{const t=h(r),a=Date.now()/1e3;if(t.exp&&t.exp<a){console.warn("⚠️ Token expired, logout otomatis"),this.logout();return}this.token=r}catch(t){console.error("❌ Token invalid:",t),this.logout();return}else this.token=null;try{e.value&&typeof e.value=="string"?this.user=JSON.parse(decodeURIComponent(e.value)):this.user=e.value}catch(t){console.error("❌ Gagal parse cookie user:",t),this.user=null,this.logout()}},async logout(){const o=n("token"),e=n("user");o.value=null,e.value=null,this.token=null,this.user=null,c("/login")}}});export{k as u};
