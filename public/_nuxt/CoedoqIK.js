import{b2 as u}from"./DirAx5lA.js";import{e as s,n as l,bo as i}from"#entry";const k=u("user",{state:()=>({token:null,user:null}),actions:{setAuth(t,e){this.token=t,this.user=e;const n=s("token",{path:"/",maxAge:3600*24*7}),o=s("user",{path:"/",maxAge:3600*24*7});n.value=t,o.value=JSON.stringify(e)},async loadAuth(){const t=s("token"),e=s("user"),n=t.value;if(n)try{const o=i(n),r=Date.now()/1e3;if(o.exp&&o.exp<r){console.warn("⚠️ Token expired, logout otomatis"),this.logout();return}this.token=n}catch(o){console.error("❌ Token invalid:",o),this.logout();return}else this.token=null;try{e.value&&typeof e.value=="string"?this.user=JSON.parse(decodeURIComponent(e.value)):this.user=e.value}catch(o){console.error("❌ Gagal parse cookie user:",o),this.user=null,this.logout()}},async logout(){const t=s("token"),e=s("user");t.value=null,e.value=null,this.token=null,this.user=null,l("/login")}}});export{k as u};
