import{_ as z}from"./Dq5CSYxr.js";import{e as L,E as G,k as p,j as H,l as K,s as q,x as Q,c as u,a,t as g,F as x,r as _,g as m,h as v,G as W,n as I,b as h,w as X,m as Y,v as Z,K as ee,o as l,H as te}from"#entry";import{T as oe,P as re,a as J,l as O,R as ae,d as ne}from"./CoINSHit.js";import{u as se}from"./BinpDrU3.js";import{u as de}from"./aY7GgY2v.js";import{u as le}from"./Dn5qd4Zw.js";import"./C5po5LRs.js";import"./C7J5lQ4g.js";import"./DsNN85AH.js";import"./DXlUCLqy.js";import"./BJSp6O0t.js";const ue={class:"flex"},ie={class:"flex h-screen overflow-hidden bg-gray-100"},ce={class:"w-min-100 bg-white border-r p-3 overflow-y-auto dark:bg-black"},me=["onDragstart"],pe=["onDragstart"],ve={class:"flex-1 p-5 overflow-auto w-full bg-white dark:bg-black"},fe={key:0,class:"flex items-center justify-between sticky top-0 z-50 px-6 py-3 transition-colors duration-300 backdrop-blur-md"},be={key:0,class:"text-gray-400 text-center py-20"},ge=["onClick"],he={key:1,class:"panel font-mono text-sm rounded-xl p-4 overflow-auto max-h-[80vh]"},ye={class:"w-1/4 bg-white border-l p-4 overflow-y-auto dark:bg-black"},we={key:0},Ae=L({__name:"[...slug]",setup(ke){const T=G(),y=se(),S=p(""),d=p([]),i=p(null),f=p(null),c=p(!1),b=p(!0),{getMenuForm:C}=de(),V=le();function A(e){const t=J.find(s=>s.type===e)||O.find(s=>s.type===e);return t?JSON.parse(JSON.stringify(t.props||{})):{}}const N=e=>{event?.dataTransfer?.setData("component",JSON.stringify(e)),window.draggingComponent=e},E=e=>{const t=e.dataTransfer?.getData("component");if(!t)return;const s=JSON.parse(t),r=A(s.type),n={id:Math.random().toString(36).substr(2,9),type:s.type,label:s.label,props:{...r},children:s.children?[]:void 0};d.value.push(n)},F=([e,t])=>{const s=r=>{for(const n of r){if(n.id===e)return Array.isArray(n.children)||(n.children=[]),n.children.push(t),!0;if(n.children&&s(n.children))return!0}return!1};s(d.value)},M=e=>{if(!confirm(`Are you sure you want to delete "${e.label}"?`))return;const t=s=>{const r=s.findIndex(n=>n.id===e.id);if(r!==-1)return s.splice(r,1),!0;for(const n of s)if(n.children&&t(n.children))return!0;return!1};t(d.value),i.value=null},w=e=>{i.value=e},R=()=>{c.value=!c.value},P=()=>{b.value=!b.value},U=async()=>{d.value=[]},B=async()=>{const e=new FormData;e.append("flowname","modifmenuaccess"),e.append("menu","admin"),e.append("search","true"),e.append("menuaccessid",o.menuAccessId),e.append("menuname",o.menuName),e.append("description",o.description),e.append("menucode",o.menuCode),e.append("menuurl",o.menuUrl),e.append("menuicon",o.menuIcon),e.append("moduleiId",o.moduleId),e.append("sortorder",o.sortOrder),e.append("menuversion",o.menuVersion),e.append("menutype",o.menuType),e.append("recordstatus",o.recordStatus),e.append("menuform",JSON.stringify(S.value));try{const t=await V.post("admin/execute-flow",e);t?.code==200?y.add({title:"Success",description:"Runtime schema saved successfully",color:"ssuccess"}):y.add({title:"Error",description:t.message,color:"error"})}catch(t){y.add({title:"Error",description:t,color:"error"})}},o=H({menuAccessId:Number,menuName:String,description:String,menuCode:String,menuUrl:String,menuIcon:String,moduleId:Number,sortOrder:Number,menuVersion:String,menuType:String,recordStatus:Number}),D=async()=>{try{const e=await C(T.params.slug);e?.code==200?(o.menuAccessId=e?.data.data.menuaccessid,o.menuName=e?.data.data.menuname,o.description=e?.data.data.description,o.menuCode=e?.data.data.menucode,o.menuUrl=e?.data.data.menuurl,o.menuIcon=e?.data.data.menuicon,o.moduleId=e?.data.data.moduleid,o.sortOrder=e?.data.data.sortorder,o.menuVersion=e?.data.data.menuversion,o.menuType=e?.data.data.menutype,o.recordStatus=e?.data.data.recordstatus,e?.data.data.menuform!=""&&(f.value=e?.data?.data.menuform,d.value=JSON.parse(e?.data?.data.menuform))):console.error("Invalid response from ",e)}catch(e){console.error("Error loading :",e)}},$=async()=>{const e=window.prompt("Copy Schema From ? ");if(e)try{const t=await C(e);t?.code==200?t?.data.data.menuform!=""&&(f.value=t?.data?.data.menuform,d.value=JSON.parse(t?.data?.data.menuform)):console.error("Invalid response from ",t)}catch(t){console.error("Error loading :",t)}else console.warn("Empty")};K(async()=>{D()});const k=q({get(){return JSON.stringify(d.value,null,2)},set(e){try{d.value=JSON.parse(e)}catch{}}});return Q(d,e=>{S.value=e,f.value=e},{deep:!0,immediate:!0}),(e,t)=>{const s=z;return l(),u(x,null,[a("div",ue,[a("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:B}," ðŸ’¾ Save Schema "),a("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:U}," Clear Schema "),a("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:D}," ðŸ“‚ Load Schema "),a("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:$}," ðŸ“‚ Copy From ... "),a("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:R},g(c.value?"ðŸ§± Edit Mode":"ðŸ‘ Preview"),1),a("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:P},g(b.value?"ðŸ§± Debug Off":"ðŸ‘ Debug On"),1)]),a("div",ie,[a("aside",ce,[t[4]||(t[4]=a("h2",{class:"font-bold text-lg mb-3"},"Elements",-1)),(l(!0),u(x,null,_(m(J),(r,n)=>(l(),u("div",{key:n,class:"border rounded p-2 mb-2 cursor-move hover:bg-gray-100 dark:hover:bg-white dark:hover:text-black",draggable:"true",onDragstart:j=>N(r)},g(r.label),41,me))),128)),t[5]||(t[5]=a("h3",{class:"font-bold text-lg mb-3"},"Containers",-1)),(l(!0),u(x,null,_(m(O),(r,n)=>(l(),u("div",{key:"grp-"+n,class:"border rounded p-2 mb-2 cursor-move hover:bg-gray-100 dark:hover:bg-white dark:hover:text-black",draggable:"true",onDragstart:j=>N(r)},g(r.label),41,pe))),128))]),a("main",ve,[c.value?(l(),u("div",fe,[f.value?(l(),W(s,{key:0,schema:f.value,menuName:m(o).menuName,formType:m(o).menuType,title:m(o).description},null,8,["schema","menuName","formType","title"])):v("",!0)])):v("",!0),c.value?v("",!0):(l(),u("div",{key:1,class:"min-h-[80vh] rounded-xl shadow-inner",onDragover:t[2]||(t[2]=I(()=>{},["prevent"])),onDrop:E},[d.value?.length?v("",!0):(l(),u("div",be," Drag components or containers here ")),h(m(ne),{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=r=>d.value=r),group:"components","item-key":"id",class:"space-y-3"},{item:X(({element:r})=>[a("div",{class:te(["panel border rounded p-3 cursor-pointer relative group",{"border-blue-600":i.value?.id===r.id}]),onClick:I(n=>w(r),["stop"])},[h(ae,{node:r,preview:c.value,showJson:b.value,selected:i.value,onSelect:w,onDropChild:F,onDelete:M},null,8,["node","preview","showJson","selected"])],10,ge)]),_:1},8,["modelValue"]),b.value&&!c.value?(l(),u("div",he,[t[6]||(t[6]=a("h1",null,"Debug",-1)),Y(a("textarea",{"onUpdate:modelValue":t[1]||(t[1]=r=>ee(k)?k.value=r:null),class:"w-full h-120 p-3 border rounded font-mono text-sm"},null,512),[[Z,m(k)]])])):v("",!0)],32))]),a("aside",ye,[t[8]||(t[8]=a("h3",{class:"font-semibold mb-3"},"Form Structure",-1)),h(oe,{nodes:d.value,selected:i.value,onSelect:w},null,8,["nodes","selected"]),t[9]||(t[9]=a("hr",{class:"my-4"},null,-1)),i.value&&!c.value?(l(),u("div",we,[t[7]||(t[7]=a("h3",{class:"font-semibold mb-3"},"Properties",-1)),h(re,{modelValue:i.value.props,"onUpdate:modelValue":t[3]||(t[3]=r=>i.value.props=r)},null,8,["modelValue"])])):v("",!0)])])],64)}}});export{Ae as default};
