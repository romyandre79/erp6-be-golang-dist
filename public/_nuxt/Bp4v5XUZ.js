import{_ as $}from"./Dq5CSYxr.js";import{e as U,E as j,k as p,j as z,l as L,s as W,x as G,c as i,a as r,t as f,F as x,r as N,g as m,h as g,G as H,n as J,b,w as K,m as q,v as Q,K as X,o as d,H as Y}from"#entry";import{T as Z,P as ee,a as te,l as oe,R as ae,d as re}from"./CoINSHit.js";import{u as ne}from"./BinpDrU3.js";import{u as se}from"./SFn6P8iF.js";import{u as de}from"./Dn5qd4Zw.js";import"./C5po5LRs.js";import"./C7J5lQ4g.js";import"./DsNN85AH.js";import"./DXlUCLqy.js";import"./BJSp6O0t.js";const le={class:"flex"},ie={class:"flex h-screen overflow-hidden bg-gray-100"},ue={class:"w-1/5 bg-white border-r p-3 overflow-y-auto dark:bg-black"},ce=["onDragstart"],me=["onDragstart"],pe={class:"flex-1 p-5 overflow-auto w-full bg-white dark:bg-black"},ge={key:0,class:"flex items-center justify-between sticky top-0 z-50 px-6 py-3 transition-colors duration-300 backdrop-blur-md"},ve={key:0,class:"text-gray-400 text-center py-20"},we=["onClick"],fe={key:1,class:"panel font-mono text-sm rounded-xl p-4 overflow-auto max-h-[80vh]"},be={class:"w-1/4 bg-white border-l p-4 overflow-y-auto dark:bg-black"},he={key:0},Ve=U({__name:"[...slug]",setup(ye){const E=j(),h=ne(),S=p(""),s=p([]),u=p(null),v=p(null),c=p(!1),w=p(!0),{getWidgetForm:C}=se(),F=de(),_=e=>{event?.dataTransfer?.setData("component",JSON.stringify(e)),window.draggingComponent=e},T=e=>{const t=e.dataTransfer?.getData("component");if(!t)return;const l=JSON.parse(t),o={id:Math.random().toString(36).substr(2,9),...l};s.value.push(o),window.draggingComponent=null},V=([e,t])=>{const l=o=>{for(const n of o){if(n.id===e)return Array.isArray(n.children)||(n.children=[]),n.children.push(t),!0;if(n.children&&l(n.children))return!0}return!1};l(s.value)},O=e=>{if(!confirm(`Are you sure you want to delete "${e.label}"?`))return;const t=l=>{const o=l.findIndex(n=>n.id===e.id);if(o!==-1)return l.splice(o,1),!0;for(const n of l)if(n.children&&t(n.children))return!0;return!1};t(s.value),u.value=null},y=e=>{u.value=e},M=()=>{c.value=!c.value},R=()=>{w.value=!w.value},A=async()=>{s.value=[]},P=async()=>{const e=new FormData;e.append("flowname","modifwidget"),e.append("menu","admin"),e.append("search","true"),e.append("widgetid",a.widgetid),e.append("widgetname",a.widgetname),e.append("description",a.description),e.append("widgettitle",a.widgettitle),e.append("widgetversion",a.widgetversion),e.append("widgetby",a.widgetby),e.append("moduleid",a.moduleid),e.append("recordstatus",a.recordStatus),e.append("widgetform",JSON.stringify(S.value));try{const t=await F.post("admin/execute-flow",e);t?.code==200?h.add({title:"Success",description:"Runtime schema saved successfully",color:"success"}):h.add({title:"Error",description:t.message,color:"error"})}catch(t){h.add({title:"Error",description:t,color:"error"})}},a=z({widgetid:Number,widgetname:String,widgettitle:String,widgetversion:String,widgetform:String,description:String,moduleid:Number,modulename:String,widgetby:String,installdate:String,recordStatus:Number}),D=async()=>{try{const e=await C(E.params.slug);e?.code==200?(a.widgetid=e?.data.data.widgetid,a.widgetname=e?.data.data.widgetname,a.description=e?.data.data.description,a.widgettitle=e?.data.data.widgettitle,a.widgetversion=e?.data.data.widgetversion,a.moduleid=e?.data.data.moduleid,a.modulename=e?.data.data.modulename,a.widgetby=e?.data.data.widgetby,a.installdate=e?.data.data.installdate,a.recordStatus=e?.data.data.recordstatus,e?.data.data.widgetform!=""&&(v.value=e?.data?.data.widgetform,s.value=JSON.parse(e?.data?.data.widgetform))):console.error("Invalid response from ",e)}catch(e){console.error("Error loading :",e)}},B=async()=>{const e=window.prompt("Copy Schema From ? ");if(e)try{const t=await C(e);t?.code==200?t?.data.data.menuform!=""&&(v.value=t?.data?.data.menuform,s.value=t?.data?.data.menuform):console.error("Invalid response from ",t)}catch(t){console.error("Error loading :",t)}else console.warn("Empty")};L(async()=>{D()});const k=W({get(){return JSON.stringify(s.value,null,2)},set(e){try{s.value=JSON.parse(e)}catch{}}});return G(s,e=>{S.value=e,v.value=e},{deep:!0,immediate:!0}),(e,t)=>{const l=$;return d(),i(x,null,[r("div",le,[r("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:P}," ðŸ’¾ Save Schema "),r("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:A}," Clear Schema "),r("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:D}," ðŸ“‚ Load Schema "),r("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:B}," ðŸ“‚ Copy From ... "),r("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:M},f(c.value?"ðŸ§± Edit Mode":"ðŸ‘ Preview"),1),r("button",{class:"text-black dark:text-white w-full py-1 rounded cursor-pointer",onClick:R},f(w.value?"ðŸ§± Debug Off":"ðŸ‘ Debug On"),1)]),r("div",ie,[r("aside",ue,[t[4]||(t[4]=r("h2",{class:"font-bold text-lg mb-3"},"Elements",-1)),(d(!0),i(x,null,N(m(te),(o,n)=>(d(),i("div",{key:n,class:"border rounded p-2 mb-2 cursor-move hover:bg-gray-100 dark:hover:bg-white dark:hover:text-black",draggable:"true",onDragstart:I=>_(o)},f(o.label),41,ce))),128)),t[5]||(t[5]=r("h3",{class:"font-bold text-lg mb-3"},"Containers",-1)),(d(!0),i(x,null,N(m(oe),(o,n)=>(d(),i("div",{key:"grp-"+n,class:"border rounded p-2 mb-2 cursor-move hover:bg-gray-100 dark:hover:bg-white dark:hover:text-black",draggable:"true",onDragstart:I=>_(o)},f(o.label),41,me))),128))]),r("main",pe,[c.value?(d(),i("div",ge,[v.value?(d(),H(l,{key:0,schema:v.value,menuName:m(a).menuName,formType:m(a).menuType,title:m(a).description},null,8,["schema","menuName","formType","title"])):g("",!0)])):g("",!0),c.value?g("",!0):(d(),i("div",{key:1,class:"min-h-[80vh] rounded-xl shadow-inner",onDragover:t[2]||(t[2]=J(()=>{},["prevent"])),onDrop:T},[s.value?.length?g("",!0):(d(),i("div",ve," Drag components or containers here ")),b(m(re),{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o),group:"components","item-key":"id",class:"space-y-3"},{item:K(({element:o})=>[r("div",{class:Y(["panel border rounded p-3 cursor-pointer relative group",{"border-blue-600":u.value?.id===o.id}]),onClick:J(n=>y(o),["stop"])},[b(ae,{node:o,preview:c.value,showJson:w.value,selected:u.value,onSelect:y,onDropChild:V,onDelete:O},null,8,["node","preview","showJson","selected"])],10,we)]),_:1},8,["modelValue"]),w.value&&!c.value?(d(),i("div",fe,[t[6]||(t[6]=r("h1",null,"Debug",-1)),q(r("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>X(k)?k.value=o:null),class:"w-full h-120 p-3 border rounded font-mono text-sm"},null,512),[[Q,m(k)]])])):g("",!0)],32))]),r("aside",be,[t[8]||(t[8]=r("h3",{class:"font-semibold mb-3"},"Form Structure",-1)),b(Z,{nodes:s.value,selected:u.value,onSelect:y},null,8,["nodes","selected"]),t[9]||(t[9]=r("hr",{class:"my-4"},null,-1)),u.value&&!c.value?(d(),i("div",he,[t[7]||(t[7]=r("h3",{class:"font-semibold mb-3"},"Properties",-1)),b(ee,{modelValue:u.value.props,"onUpdate:modelValue":t[3]||(t[3]=o=>u.value.props=o)},null,8,["modelValue"])])):g("",!0)])])],64)}}});export{Ve as default};
