import{aU as L,s as E,ay as w,aO as W,aV as H,av as V,aW as G,aj as J,aA as Z,aX as X,A as F,aY as Y,an as Q,k as x,al as U,aJ as k,O as K,aZ as A,g as q,am as tt,j as z,a_ as et,a$ as at,q as st}from"#entry";import{u as nt}from"./Bhw12tYx.js";const it=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],ot=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],rt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",P=[];class ct{_data=new S;_hash=new S([...it]);_nDataBytes=0;_minBufferSize=0;finalize(t){t&&this._append(t);const s=this._nDataBytes*8,e=this._data.sigBytes*8;return this._data.words[e>>>5]|=128<<24-e%32,this._data.words[(e+64>>>9<<4)+14]=Math.floor(s/4294967296),this._data.words[(e+64>>>9<<4)+15]=s,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(t,s){const e=this._hash.words;let n=e[0],r=e[1],i=e[2],o=e[3],f=e[4],m=e[5],c=e[6],u=e[7];for(let l=0;l<64;l++){if(l<16)P[l]=t[s+l]|0;else{const p=P[l-15],d=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,y=P[l-2],B=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;P[l]=d+P[l-7]+B+P[l-16]}const g=f&m^~f&c,_=n&r^n&i^r&i,h=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),v=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),D=u+v+g+ot[l]+P[l],b=h+_;u=c,c=m,m=f,f=o+D|0,o=i,i=r,r=n,n=D+b|0}e[0]=e[0]+n|0,e[1]=e[1]+r|0,e[2]=e[2]+i|0,e[3]=e[3]+o|0,e[4]=e[4]+f|0,e[5]=e[5]+m|0,e[6]=e[6]+c|0,e[7]=e[7]+u|0}_append(t){typeof t=="string"&&(t=S.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let s,e=this._data.sigBytes/64;t?e=Math.ceil(e):e=Math.max((e|0)-this._minBufferSize,0);const n=e*16,r=Math.min(n*4,this._data.sigBytes);if(n){for(let i=0;i<n;i+=16)this._doProcessBlock(this._data.words,i);s=this._data.words.splice(0,n),this._data.sigBytes-=r}return new S(s,r)}}class S{words;sigBytes;constructor(t,s){t=this.words=t||[],this.sigBytes=s===void 0?t.length*4:s}static fromUtf8(t){const s=unescape(encodeURIComponent(t)),e=s.length,n=[];for(let r=0;r<e;r++)n[r>>>2]|=(s.charCodeAt(r)&255)<<24-r%4*8;return new S(n,e)}toBase64(){const t=[];for(let s=0;s<this.sigBytes;s+=3){const e=this.words[s>>>2]>>>24-s%4*8&255,n=this.words[s+1>>>2]>>>24-(s+1)%4*8&255,r=this.words[s+2>>>2]>>>24-(s+2)%4*8&255,i=e<<16|n<<8|r;for(let o=0;o<4&&s*8+o*6<this.sigBytes*8;o++)t.push(rt.charAt(i>>>6*(3-o)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let s=0;s<t.sigBytes;s++){const e=t.words[s>>>2]>>>24-s%4*8&255;this.words[this.sigBytes+s>>>2]|=e<<24-(this.sigBytes+s)%4*8}else for(let s=0;s<t.sigBytes;s+=4)this.words[this.sigBytes+s>>>2]=t.words[s>>>2];this.sigBytes+=t.sigBytes}}function lt(a){return new ct().finalize(a).toBase64()}function C(a){return lt(L(a))}const ut={trailing:!0};function dt(a,t=25,s={}){if(s={...ut,...s},!Number.isFinite(t))throw new TypeError("Expected `wait` to be a finite number");let e,n,r=[],i,o;const f=(u,l)=>(i=ft(a,u,l),i.finally(()=>{if(i=null,s.trailing&&o&&!n){const g=f(u,o);return o=null,g}}),i),m=function(...u){return s.trailing&&(o=u),i||new Promise(l=>{const g=!n&&s.leading;clearTimeout(n),n=setTimeout(()=>{n=null;const _=s.leading?e:f(this,u);o=null;for(const h of r)h(_);r=[]},t),g?(e=f(this,u),l(e)):r.push(l)})},c=u=>{u&&(clearTimeout(u),n=null)};return m.isPending=()=>!!n,m.cancel=()=>{c(n),r=[],o=null},m.flush=()=>{if(c(n),!o||i)return;const u=o;return o=null,f(this,u)},m}async function ft(a,t,s){return await a.apply(t,s)}function ht(...a){const t=typeof a[a.length-1]=="string"?a.pop():void 0;yt(a[0],a[1])&&a.unshift(t);let[s,e,n={}]=a,r=!1;const i=E(()=>w(s));if(typeof i.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof e!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const o=W();n.server??=!0,n.default??=mt,n.getCachedData??=I,n.lazy??=!1,n.immediate??=!0,n.deep??=H.deep,n.dedupe??="cancel",n._functionName,o._asyncData[i.value];function f(){const _={cause:"initial",dedupe:n.dedupe};return o._asyncData[i.value]?._init||(_.cachedData=n.getCachedData(i.value,o,{cause:"initial"}),o._asyncData[i.value]=$(o,i.value,e,n,_.cachedData)),()=>o._asyncData[i.value].execute(_)}const m=f(),c=o._asyncData[i.value];c._deps++;const u=n.server!==!1&&o.payload.serverRendered;{let _=function(d){const y=o._asyncData[d];y?._deps&&(y._deps--,y._deps===0&&y?._off())};const h=V();if(h&&u&&n.immediate&&!h.sp&&(h.sp=[]),h&&!h._nuxtOnBeforeMountCbs){h._nuxtOnBeforeMountCbs=[];const d=h._nuxtOnBeforeMountCbs;G(()=>{d.forEach(y=>{y()}),d.splice(0,d.length)}),J(()=>d.splice(0,d.length))}const v=h&&(h._nuxtClientOnly||Z(X,!1));u&&o.isHydrating&&(c.error.value||c.data.value!==void 0)?c.status.value=c.error.value?"error":"success":h&&(!v&&o.payload.serverRendered&&o.isHydrating||n.lazy)&&n.immediate?h._nuxtOnBeforeMountCbs.push(m):n.immediate&&c.status.value!=="success"&&m();const D=tt(),b=F(i,(d,y)=>{if((d||y)&&d!==y){r=!0;const B=o._asyncData[y]?.data.value!==void 0,O=o._asyncDataPromises[y]!==void 0,j={cause:"initial",dedupe:n.dedupe};if(!o._asyncData[d]?._init){let R;y&&B?R=o._asyncData[y].data.value:(R=n.getCachedData(d,o,{cause:"initial"}),j.cachedData=R),o._asyncData[d]=$(o,d,e,n,R)}o._asyncData[d]._deps++,y&&_(y),(n.immediate||B||O)&&o._asyncData[d].execute(j),Y(()=>{r=!1})}},{flush:"sync"}),p=n.watch?F(n.watch,()=>{r||c._execute({cause:"watch",dedupe:n.dedupe})}):()=>{};D&&Q(()=>{b(),p(),_(i.value)})}const l={data:T(()=>o._asyncData[i.value]?.data),pending:T(()=>o._asyncData[i.value]?.pending),status:T(()=>o._asyncData[i.value]?.status),error:T(()=>o._asyncData[i.value]?.error),refresh:(..._)=>o._asyncData[i.value]?._init?o._asyncData[i.value].execute(..._):f()(),execute:(..._)=>l.refresh(..._),clear:()=>N(o,i.value)},g=Promise.resolve(o._asyncDataPromises[i.value]).then(()=>l);return Object.assign(g,l),g}function T(a){return E({get(){return a()?.value},set(t){const s=a();s&&(s.value=t)}})}function yt(a,t){return!(typeof a=="string"||typeof a=="object"&&a!==null||typeof a=="function"&&typeof t=="function")}function N(a,t){t in a.payload.data&&(a.payload.data[t]=void 0),t in a.payload._errors&&(a.payload._errors[t]=void 0),a._asyncData[t]&&(a._asyncData[t].data.value=q(a._asyncData[t]._default()),a._asyncData[t].error.value=void 0,a._asyncData[t].status.value="idle"),t in a._asyncDataPromises&&(a._asyncDataPromises[t]&&(a._asyncDataPromises[t].cancelled=!0),a._asyncDataPromises[t]=void 0)}function _t(a,t){const s={};for(const e of t)s[e]=a[e];return s}function $(a,t,s,e,n){a.payload._errors[t]??=void 0;const r=e.getCachedData!==I,i=s,o=e.deep?x:U,f=n!==void 0,m=a.hook("app:data:refresh",async u=>{(!u||u.includes(t))&&await c.execute({cause:"refresh:hook"})}),c={data:o(f?n:e.default()),pending:E(()=>c.status.value==="pending"),error:k(a.payload._errors,t),status:U("idle"),execute:(...u)=>{const[l,g=void 0]=u,_=l&&g===void 0&&typeof l=="object"?l:{};if(a._asyncDataPromises[t]){if((_.dedupe??e.dedupe)==="defer")return a._asyncDataPromises[t];a._asyncDataPromises[t].cancelled=!0}{const v="cachedData"in _?_.cachedData:e.getCachedData(t,a,{cause:_.cause??"refresh:manual"});if(v!==void 0)return a.payload.data[t]=c.data.value=v,c.error.value=void 0,c.status.value="success",Promise.resolve(v)}c.status.value="pending";const h=new Promise((v,D)=>{try{v(i(a))}catch(b){D(b)}}).then(async v=>{if(h.cancelled)return a._asyncDataPromises[t];let D=v;e.transform&&(D=await e.transform(v)),e.pick&&(D=_t(D,e.pick)),a.payload.data[t]=D,c.data.value=D,c.error.value=void 0,c.status.value="success"}).catch(v=>{if(h.cancelled)return a._asyncDataPromises[t];c.error.value=A(v),c.data.value=q(e.default()),c.status.value="error"}).finally(()=>{h.cancelled||delete a._asyncDataPromises[t]});return a._asyncDataPromises[t]=h,a._asyncDataPromises[t]},_execute:dt((...u)=>c.execute(...u),0,{leading:!0}),_default:e.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{m(),a._asyncData[t]?._init&&(a._asyncData[t]._init=!1),r||K(()=>{a._asyncData[t]?._init||(N(a,t),c.execute=()=>Promise.resolve())})}};return c}const mt=()=>{},I=(a,t,s)=>{if(t.isHydrating)return t.payload.data[a];if(s.cause!=="refresh:manual"&&s.cause!=="refresh:hook")return t.static.data[a]};function M(a,t,s){const[e={},n]=typeof t=="string"?[{},t]:[t,s],r=E(()=>w(a)),i=E(()=>w(e.key)||"$f"+C([n,typeof r.value=="string"?r.value:"",...vt(e)]));if(!e.baseURL&&typeof r.value=="string"&&r.value[0]==="/"&&r.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:o,lazy:f,default:m,transform:c,pick:u,watch:l,immediate:g,getCachedData:_,deep:h,dedupe:v,...D}=e,b=z({...et,...D,cache:typeof e.cache=="boolean"?void 0:e.cache}),p={server:o,lazy:f,default:m,transform:c,pick:u,immediate:g,getCachedData:_,deep:h,dedupe:v,watch:l===!1?[]:[...l||[],b]};let d;return ht(l===!1?i.value:i,()=>{d?.abort?.(new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),d=typeof AbortController<"u"?new AbortController:{};const B=w(e.timeout);let O;return B&&(O=setTimeout(()=>d.abort(new DOMException("Request aborted due to timeout.","AbortError")),B),d.signal.onabort=()=>clearTimeout(O)),(e.$fetch||globalThis.$fetch)(r.value,{signal:d.signal,...b}).finally(()=>{clearTimeout(O)})},p)}function vt(a){const t=[w(a.method)?.toUpperCase()||"GET",w(a.baseURL)];for(const s of[a.params||a.query]){const e=w(s);if(!e)continue;const n={};for(const[r,i]of Object.entries(e))n[w(r)]=w(i);t.push(n)}if(a.body){const s=w(a.body);if(!s)t.push(C(s));else if(s instanceof ArrayBuffer)t.push(C(Object.fromEntries([...new Uint8Array(s).entries()].map(([e,n])=>[e,n.toString()]))));else if(s instanceof FormData){const e={};for(const n of s.entries()){const[r,i]=n;e[r]=i instanceof File?i.name:i}t.push(C(e))}else if(at(s))t.push(C(z(s)));else try{t.push(C(s))}catch{console.warn("[useFetch] Failed to hash body",s)}}return t}const wt=st("notification",{state:()=>({notifications:[],ws:null,connected:!1,reconnectInterval:1e3}),getters:{unreadCount:a=>a.notifications.filter(t=>t.isread===0).length},actions:{async fetchUnread(){const{data:a}=await M("/api/admin/notifications/unread","$2dHEnwL9Wl");a.value&&a.value.status==="success"&&(this.notifications=a.value.data||[])},async markAsRead(a){await M(`/api/admin/notifications/${a}/read`,{method:"POST"},"$RicZWHqi3K");const t=this.notifications.find(s=>s.usertodoid===a);t&&(t.isread=1)},async connect(){const t=nt().token||localStorage.getItem("token");if(!t)return;const n=`${window.location.protocol==="https:"?"wss:":"ws:"}//localhost:8888/ws/notifications?token=${t}`;console.log("Connecting WS:",n),this.ws=new WebSocket(n),this.ws.onopen=()=>{console.log("WS Connected"),this.connected=!0},this.ws.onmessage=r=>{try{const i=JSON.parse(r.data);if(i.type==="notification"){this.notifications.unshift(i.data);const{$toast:o}=W();o&&o.add({title:i.data.menuname,description:i.data.description})}}catch(i){console.error("WS Parse error",i)}},this.ws.onclose=()=>{this.connected=!1,setTimeout(()=>this.connect(),this.reconnectInterval)},this.ws.onerror=r=>{console.error("WS Error",r),this.ws?.close()}},async sendMessage(a,t,s,e=""){const{data:n,error:r}=await M("/api/admin/notifications/send",{method:"POST",body:{receiverid:a,title:t,message:s,docno:e}},"$RoMatoeq2f");if(r.value)throw r.value;return n.value}}});export{wt as u};
