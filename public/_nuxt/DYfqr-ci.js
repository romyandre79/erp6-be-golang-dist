import{_ as Ue}from"./DRv9w82P.js";import{q as Be,k as w,e as Fe,j as z,s as Pe,x as ne,l as Oe,c as h,a,b as C,w as T,y as H,n as I,F as R,r as V,h as le,m as $,v as N,t as D,z as se,o as y,d as L,A as ze,B as Ye,C as We,D as Xe}from"#entry";import{u as qe}from"./Bs5g203e.js";import{t as ie}from"./CCayPtYg.js";import{u as Je}from"./BinpDrU3.js";import"./DsNN85AH.js";import"./B875pGO5.js";import"./BJSp6O0t.js";const Ze=Be("dbobject",()=>{const B=w([]),j=w({dbobjectid:"",objectname:"",dbobjecttypeid:"",objectcontent:"",objectversion:"",ispublished:0,comment:""}),_=w(!1),c=qe();async function b(){_.value=!0;try{let u=new FormData;u.append("flowname","searchcombodbobjecttype"),u.append("menu","admin"),u.append("search","true");let p=await c.post("/admin/execute-flow",u);B.value=p?.data?.data??{},u=new FormData,u.append("flowname","searchdbobject"),u.append("menu","admin"),u.append("search","true"),p=await c.post("/admin/execute-flow",u),B.value=p?.data?.data??{}}finally{_.value=!1}}async function g(u){_.value=!0;try{const p=new FormData;p.append("flowname","getdbobject"),p.append("menu","admin"),p.append("search","true"),p.append("dbobjectid",u);const S=await c.post("/admin/execute-flow",p);j.value=S?.data?.data??{}}finally{_.value=!1}}async function x(u){try{const p=new FormData;p.append("flowname","modifdbobject"),p.append("menu","admin"),p.append("search","true"),p.append("dbobjectid",u.dbobjectid),p.append("objectname",u.objectname),p.append("dbobjecttypeid",u.dbobjecttypeid),p.append("objectcontent",u.objectcontent),p.append("ispublished",u.ispublished),p.append("comment",u.comment),await c.post("/admin/execute-flow",p)}finally{_.value=!1}}async function E(u){try{const p=new FormData;p.append("flowname","purgedbobject"),p.append("menu","admin"),p.append("search","true"),p.append("dbobjectid",u),await c.post("/admin/execute-flow",p)}finally{_.value=!1}}return{fetchAll:b,fetch:g,saveTable:x,purgeTable:E,dbobject:j,dbobjects:B,loading:_}}),Ge={class:"h-screen flex flex-col bg-gray-50"},He={class:"flex items-center justify-between p-4 border-b bg-white sticky"},Ke={class:"flex items-center gap-2"},Qe={class:"flex items-center gap-2"},et={class:"flex-1 relative overflow-hidden"},tt={class:"absolute inset-0 overflow-auto"},ot=["data-area-id","onMousedown"],nt={class:"bg-purple-600 text-white text-xs px-2 py-1 rounded-t-xl cursor-move flex items-center justify-between"},lt=["onUpdate:modelValue"],st={class:"flex items-center"},it=["onMousedown"],at={class:"absolute inset-0 pointer-events-none",style:{overflow:"visible"}},dt=["d"],rt=["d"],ct=["onDragstart","onDblclick","data-table-id"],ut={class:"flex items-center justify-between p-2 bg-gray-800 text-white rounded-t"},pt={class:"font-medium"},mt={class:"flex gap-1"},ft={class:"p-2 text-xs"},bt=["data-col-index"],vt={class:"w-6 text-gray-600"},xt={class:"flex-1 truncate"},ht={class:"text-gray-500 text-[11px]"},yt=["onPointerdown"],wt={class:"absolute right-0 top-0 bottom-0 w-96 border-l bg-white p-4 overflow-auto z-10 shadow-lg"},gt={class:"mt-4"},kt={class:"flex gap-2 mt-1"},Ct={key:0,class:"space-y-4"},$t={class:"text-lg font-semibold"},_t={class:"flex gap-2 mt-1"},jt={class:"mt-2 space-y-2"},At=["onUpdate:modelValue"],Nt=["onUpdate:modelValue"],St=["onUpdate:modelValue"],Tt=["onUpdate:modelValue"],Dt=["onClick"],Lt={class:"flex gap-2"},Et={class:"mt-4"},It={key:0},Mt={class:"text-sm"},Rt={class:"flex gap-2"},Vt=["onClick"],Ut={key:1,class:"text-gray-400 text-sm"},ae=.1,Bt=.2,Ft=3,Zt=Fe({__name:"dbobject",setup(B){let j=1,_=1;const c=z([]),b=z([]),g=Je(),x=z([]);let E=1;const u=w(null),p=w(null),S=w({x:0,y:0}),Y=w(null),F=w(null),W=w({x:0,y:0}),P=w(null),X=w(""),O=Ze();w({dbobjectid:"",objectname:"",dbobjecttypeid:"",objectcontent:"",objectversion:"",ispublished:0,comment:""});const k=w(1),v=z({active:!1,from:null,sx:0,sy:0,path:""});function de(){k.value=Math.min(k.value+ae,Ft)}function re(){k.value=Math.max(k.value-ae,Bt)}function ce(){k.value=1}function ue(){let o=40,e=40;if(u.value){const t=u.value;o=t.x+40,e=t.y+40}const n={id:j++,dbid:"",name:`table_${j}`,x:o,y:e,width:240,columns:[{name:"id",type:"auto"},{name:"name",type:"text"}]};c.push(n)}function pe(){c.length,ue()}function me(o,e){let n=0,t=0,s=120,l=[];if(o.objectcontent)try{const d=JSON.parse(o.objectcontent);d?.table?.columns&&Array.isArray(d.table.columns)&&(l=d.table.columns.map(r=>({name:r.name||"col",type:r.type||"text",allownull:r.allownull??!1,default:r.default??""}))),n=d?.table?.x??40+e%4*340,t=d?.table?.y??40+Math.floor(e/4)*200,s=d?.table?.width??240,d.areas&&d.areas.length>0&&d.areas.forEach(r=>{x.find(m=>m.id==r.id)==null&&fe(r)})}catch(d){console.warn(`Invalid objectcontent JSON for ${o.objectname}`,d)}return{id:j++,dbid:o.dbobjectid??"",name:o.objectname||`table_${e+1}`,x:n,y:t,width:s,columns:l,ispublished:o.ispublished==1,comment:o.comment??""}}function fe(o){console.log("data ",o);const e={id:o.id,name:o.name,x:o.x,y:o.y,width:o.width,height:o.height,color:o.color,type:"area"};x.push(e),E=o.id,be(e)}function be(o){const e=document.createElement("div");e.className="design-area",e.style.left=o.x+"px",e.style.top=o.y+"px",e.style.width=o.width+"px",e.style.height=o.height+"px",e.style.background=o.color||"#fef9c3",e.dataset.id=o.id,e.dataset.type="area",makeAreaDraggableAndResizable(e,o)}function K(o){Y.value=o;const e=c.find(n=>n.id===o);X.value=e?JSON.stringify(e,null,2):""}const f=Pe(()=>c.find(o=>o.id===Y.value)||null);function ve(o,e){F.value=o.id;const n=e.target.getBoundingClientRect();W.value={x:e.clientX-n.left,y:e.clientY-n.top}}function xe(o){const e=P.value.getBoundingClientRect();if(!F.value)return;const n=c.find(t=>t.id===F.value);n&&(n.x=o.clientX-e.left-W.value.x,n.y=o.clientY-e.top-W.value.y,F.value=null,A())}async function he(o){if(!confirm("Are you sure to delete Area ?"))return;const e=x.findIndex(n=>n.id===o);e>=0&&x.splice(e,1)}async function ye(o){if(!confirm("Are you sure to delete Table?"))return;const e=c.findIndex(t=>t.id===o),n=c.find(t=>t.id===o);n.dbid&&await O.purgeTable(n.dbid),e>=0&&c.splice(e,1);for(let t=b.length-1;t>=0;t--)(b[t].from.table===o||b[t].to.table===o)&&b.splice(t,1)}function we(o){const e=JSON.parse(JSON.stringify(o));e.id=j++,e.dbid="",e.x+=20,e.y+=20,e.name=o.name+"_copy",c.push(e),A()}function ge(){f.value&&f.value.columns.push({name:"new_col",type:"varchar"})}function ke(o){f.value&&f.value.columns.splice(o,1)}async function Ce(){confirm("Reset design?")&&await Q()}function $e(o,e){b.splice(0,b.length);const n=new Set;o.forEach(t=>{if(!t.objectcontent)return;let s=null;try{s=JSON.parse(t.objectcontent)}catch{return}Array.isArray(s.relations)&&s.relations.forEach(l=>{const i=e[l.from.table],d=e[l.to.table];if(!i||!d)return;const r=`${i}|${l.from.col}|${d}|${l.to.col}`;n.has(r)||(n.add(r),b.push({id:_++,from:{table:i,col:l.from.col,colName:l.from.colName},to:{table:d,col:l.to.col,colName:l.to.colName},path:""}))})}),A()}async function Q(){c.splice(0,c.length),b.splice(0,b.length),x.splice(0,x.length),j=1,E=1,_=1,Y.value=null,await O.fetchAll();const o=new Set,e=[],n={};(O.dbobjects||[]).forEach(t=>{const s=t?.dbobjectid?String(t.dbobjectid):t?.objectname??"";s&&(o.has(s)?console.debug("Skipping duplicate dbobject from store:",s):(o.add(s),e.push(t)))}),e.forEach((t,s)=>{const l=me(t,s);n[t.dbobjectid]=l.id,c.push(l)}),j=Math.max(...c.map(t=>t.id),0)+1,$e(e,n),A()}function _e(o,e,n){const t=P.value.getBoundingClientRect(),s=c.find(r=>r.id===o);if(!s)return;const l=s.y+36+e*24;v.active=!0,v.from={table:o,col:e},v.sx=s.x+s.width,v.sy=l,ee(n.clientX-t.left,n.clientY-t.top);const i=r=>ee(r.clientX-t.left,r.clientY-t.top),d=r=>je(r,i,d);window.addEventListener("pointermove",i),window.addEventListener("pointerup",d)}function ee(o,e){v.path=te(v.sx,v.sy,o,e)}function je(o,e,n){if(window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",n),!v.active)return;const t=P.value.getBoundingClientRect(),s=o.clientX-t.left,l=o.clientY-t.top;let i=null;for(const d of c)if(s>=d.x&&s<=d.x+d.width&&l>=d.y&&l<=d.y+200){const r=Math.floor((l-(d.y+36))/24);if(r>=0&&r<d.columns.length){i={table:d.id,col:r};break}}if(i){const d={id:_++,from:{table:v.from.table,col:v.from.col,colName:c.find(m=>m.id===v.from.table).columns[v.from.col].name},to:{table:i.table,col:i.col,colName:c.find(m=>m.id===i.table).columns[i.col].name},path:""};if(b.some(m=>m.from.table===v.from.table&&m.from.col===v.from.col&&m.to.table===i.table&&m.to.col===i.col)){v.active=!1,v.path="";return}b.push(d),A()}v.active=!1,v.path=""}function te(o,e,n,t){const s=(o+n)/2;return`M ${o} ${e} C ${s} ${e} ${s} ${t} ${n} ${t}`}function A(){b.forEach(o=>{const e=c.find(d=>d.id===o.from.table),n=c.find(d=>d.id===o.to.table);if(!e||!n)return;const t=e.y+36+o.from.col*24,s=e.x+e.width,l=n.y+36+o.to.col*24,i=n.x;o.path=te(s,t,i,l)})}function Ae(o){const e=b.findIndex(n=>n.id===o);e>=0&&b.splice(e,1)}ne(c,A,{deep:!0}),ne(b,A,{deep:!0});async function Ne(){if(!c.length)return alert("No tables to save");try{for(const o of We(c)){const e={table:o,relations:b.filter(i=>i.from.table===o.id||i.to.table===o.id).map(i=>({id:i.id,from:{...i.from,table:c.find(d=>d.id===i.from.table)?.dbid},to:{...i.to,table:c.find(d=>d.id===i.to.table)?.dbid}})),areas:x},n={dbobjectid:o.dbid?String(o.dbid):"",objectname:o.name,dbobjecttypeid:"1",objectcontent:JSON.stringify(e),objectversion:"1",ispublished:o.ispublished?1:0,comment:o.comment||""},t=await O.saveTable(n),s=t?.data?.data??t,l=s?.dbobjectid??s?.dbobjectid??null;if(l){const i=c.find(d=>d.id===o.id);i&&(i.dbid=l)}}g.add({title:"Success",description:"Runtime schema saved successfully",color:"success"})}catch(o){console.error(o),g.add({title:"Error",description:String(o),color:"error"})}}Oe(async()=>{await Q()});function Se(o){let e=100,n=100;if(x.length>0){const t=x[x.length-1];e=t.x+t.width+40,n=t.y}E++,x.push({id:E,name:"Area "+E,x:e,y:n,width:400,height:300,color:"#e3e9ff"})}const q=w([]);function Te(o,e){u.value=o,p.value="move",S.value={x:e.clientX-o.x,y:e.clientY-o.y},q.value=c.filter(n=>n.x>=o.x&&n.x<=o.x+o.width&&n.y>=o.y&&n.y<=o.y+o.height),console.log(u.value),window.addEventListener("mousemove",J),window.addEventListener("mouseup",Z)}function De(o,e){u.value=o,p.value="resize",S.value={x:e.clientX,y:e.clientY},window.addEventListener("mousemove",J),window.addEventListener("mouseup",Z)}function J(o){if(!u.value)return;const e=u.value;if(p.value==="move"){const n=o.clientX-S.value.x,t=o.clientY-S.value.y,s=n-e.x,l=t-e.y;e.x=n,e.y=t,q.value.forEach(i=>{i.x+=s,i.y+=l})}if(p.value==="resize"){const n=o.clientX-S.value.x,t=o.clientY-S.value.y;e.width+=n,e.height+=t,S.value={x:o.clientX,y:o.clientY}}}function Z(){u.value=null,p.value=null,q.value=[],window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",Z)}function Le(o){!o||!o.columns||o.columns.forEach(e=>{const n=(e.name||"").toLowerCase();n.includes("id")?e.type="auto":n.includes("date")||n.endsWith("at")?e.type="timestamp":n.startsWith("is")||n.startsWith("has")?e.type="boolean":n.includes("amount")||n.includes("price")||n.includes("total")?e.type="number":e.type="text"})}function oe(){const o=new Set(b.map(n=>`${n.from.table}_${n.from.col}-${n.to.table}_${n.to.col}`)),e=c.reduce((n,t)=>{const s=t.columns.map((l,i)=>l.type==="auto"?i:null).filter(l=>l!==null);return n[t.id]=s,n},{});for(let n=0;n<c.length;n++){const t=c[n];for(let s=0;s<c.length;s++){if(n===s)continue;const l=c[s];t.columns.forEach((i,d)=>{if(i.name.toLowerCase()===l.name.toLowerCase()+"id"){if(!e[l.id]||e[l.id].length===0)return;const r=e[l.id][0],m=`${t.id}_${d}-${l.id}_${r}`,U=`${l.id}_${r}-${t.id}_${d}`;if(o.has(m)||o.has(U))return;b.push({id:_++,from:{table:t.id,col:d,colName:i.name},to:{table:l.id,col:r,colName:l.columns[r].name},path:""}),o.add(m)}})}}A(),g.add({title:"Auto Relations",description:"Relations generated intelligently",color:"success"})}function Ee(o){if(!o)return;const n=o.trim().split(/\s+/)[0]||"table_"+j;if(c.some(r=>r.name.toLowerCase()===n.toLowerCase())){g.add({title:"Duplicate Table",description:`Table with name "${n}" already exists!`,color:"warning"});return}let t=o.toLowerCase().split("with")[1]||"";t=t.replace(/and/g,",");const s=t.split(",").map(r=>r.trim()).filter(r=>r);let l=40,i=40;if(console.log("activeArea ",u.value),u.value){const r=u.value;l=r.x+40,i=r.y+40}const d={id:j++,dbid:"",name:n,x:l,y:i,width:240,columns:s.map(r=>{let m="text";return r.includes("id")&&r.replace(/_/g,"").includes(n.toLowerCase())?m="auto":r.includes("id")?m="integer":r.includes("date")||r.endsWith("at")?m="timestamp":r.startsWith("is")||r.startsWith("has")||r.startsWith("recordstatus")?m="boolean":(r.includes("amount")||r.includes("price")||r.includes("total"))&&(m="number"),{name:r,type:m}}),ispublished:!1,comment:""};c.push(d),K(d.id),A(),oe(),g.add({title:"AI Table Generated",description:`Table "${n}" created!`,color:"success"})}function Ie(o){if(!o)return;const e=o.split(/[\.\n]/).map(n=>n.trim()).filter(Boolean);for(const n of e){const t=n.toLowerCase();if(t.startsWith("create table")){const s=n.replace(/create table/i,"").trim();Ee(s);continue}if(t.includes("add column")){const s=/add column (\w+)(?: (above|below) (\w+))?(?: (?:to|in) (\w+))?/i.exec(n);if(s){const[,l,i,d,r]=s;let m=null;if(r){if(m=c.find(G=>G.name.toLowerCase()===r.toLowerCase()),!m){g.add({title:"Table Not Found",description:`Table "${r}" not found`,color:"warning"});continue}}else if(m=f.value||c[c.length-1],!m){g.add({title:"No Table Selected",description:`Cannot add column "${l}"`,color:"warning"});continue}const U=d?m.columns.findIndex(G=>G.name.toLowerCase()===d.toLowerCase()):-1;let M="text";l.includes("id")&&l.replace(/_/g,"").includes(m.name.toLowerCase())?M="auto":l.includes("id")?M="integer":l.includes("date")||l.endsWith("at")?M="timestamp":l.startsWith("is")||l.startsWith("has")||l.startsWith("recordstatus")?M="boolean":(l.includes("amount")||l.includes("price")||l.includes("total"))&&(M="number");const Ve=U>=0?i==="above"?U:U+1:m.columns.length;m.columns.splice(Ve,0,{name:l,type:M})}continue}if(t.includes("remove column")||t.includes("delete column")){const s=/(?:remove|delete) column (\w+)/i.exec(n);if(s){const[,l]=s;let i=f.value;if(!i){g.add({title:"No Table Selected",description:`Cannot remove column "${l}"`,color:"warning"});continue}const d=i.columns.findIndex(r=>r.name.toLowerCase()===l.toLowerCase());d>=0&&i.columns.splice(d,1)}continue}if(t.includes("delete table")){const l=/delete table (\w+)?/i.exec(n)?.[1];if(l){const i=c.findIndex(d=>d.name.toLowerCase()===l.toLowerCase());i>=0&&c.splice(i,1)}else if(f.value){const i=c.findIndex(d=>d.id===f.value.id);i>=0&&c.splice(i,1)}else g.add({title:"No Table Selected",description:"Cannot delete table",color:"warning"});continue}if(t.includes("delete area")){const l=/delete area (\w+)?/i.exec(n)?.[1];if(l){const i=x.findIndex(d=>d.name.toLowerCase()===l.toLowerCase());i>=0&&x.splice(i,1)}else if(u.value){const i=x.findIndex(d=>d.id===u.value.id);i>=0&&x.splice(i,1)}else g.add({title:"No Area Selected",description:"Cannot delete area",color:"warning"});continue}console.warn("Unknown instruction:",n)}A(),g.add({title:"AI Natural Instructions Executed",description:"All recognized actions applied.",color:"success"})}async function Me(){const o=k.value;k.value=1,await Xe();try{const e=document.getElementById("drawflow");if(!e)return;const n=await ie(e,{cacheBust:!0,pixelRatio:2}),t=document.createElement("a");t.download="database-design.png",t.href=n,t.click()}catch(e){console.error("Export failed:",e),alert("Export failed")}finally{k.value=o}}async function Re(o){const e=document.createElement("div");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.background="white",e.style.padding="10px";const n=document.querySelector(`[data-area-id="${o.id}"]`);if(!n)return;const t=n.cloneNode(!0);t.style.position="relative",t.style.left="0",t.style.top="0",e.appendChild(t),c.forEach(s=>{if(s.x>=o.x&&s.x<=o.x+o.width&&s.y>=o.y&&s.y<=o.y+o.height){const l=document.querySelector(`[data-table-id="${s.id}"]`);if(l){const i=l.cloneNode(!0);i.style.position="absolute",i.style.left=s.x-o.x+"px",i.style.top=s.y-o.y+"px",e.appendChild(i)}}}),document.body.appendChild(e),ie(e,{cacheBust:!0}).then(s=>{const l=document.createElement("a");l.download=`${o.name}.png`,l.href=s,l.click(),document.body.removeChild(e)})}return(o,e)=>{const n=Ue;return y(),h("div",Ge,[a("header",He,[e[23]||(e[23]=a("div",{class:"flex items-center gap-3"},[a("h1",{class:"text-xl font-semibold"},"Database Designer")],-1)),a("div",Ke,[C(n,{icon:"heroicons:table-cells",onClick:pe,class:"px-3 py-2 rounded bg-green-600 text-white"},{default:T(()=>[...e[14]||(e[14]=[L("Add Table",-1)])]),_:1}),C(n,{icon:"heroicons:square-3-stack-3d",onClick:e[0]||(e[0]=t=>Se()),class:"px-3 py-2 rounded bg-purple-600 text-white"},{default:T(()=>[...e[15]||(e[15]=[L("Add Area",-1)])]),_:1}),C(n,{icon:"heroicons:bookmark-square",onClick:Ne,class:"px-3 py-1 rounded bg-green-600 text-white"},{default:T(()=>[...e[16]||(e[16]=[L("Save",-1)])]),_:1}),C(n,{icon:"heroicons:arrows-right-left",onClick:Ce,class:"px-3 py-1 rounded bg-red-500 text-white"},{default:T(()=>[...e[17]||(e[17]=[L("Reset",-1)])]),_:1}),C(n,{icon:"heroicons:building-library",onClick:e[1]||(e[1]=t=>oe()),class:"px-3 py-1 bg-purple-500 text-white rounded"},{default:T(()=>[...e[18]||(e[18]=[L(" AI Suggest Relations ",-1)])]),_:1})]),a("div",Qe,[C(n,{icon:"heroicons:bars-4",onClick:Me,class:"px-3 py-1 bg-indigo-500 text-white rounded"},{default:T(()=>[...e[19]||(e[19]=[L("Export PNG",-1)])]),_:1}),C(n,{icon:"heroicons:magnifying-glass-plus",onClick:de,class:"px-3 py-1 bg-blue-500 text-white rounded"},{default:T(()=>[...e[20]||(e[20]=[L("Zoom In",-1)])]),_:1}),C(n,{icon:"heroicons:magnifying-glass-minus",onClick:re,class:"px-3 py-1 bg-blue-500 text-white rounded"},{default:T(()=>[...e[21]||(e[21]=[L("Zoom Out",-1)])]),_:1}),C(n,{icon:"heroicons:arrows-right-left",onClick:ce,class:"px-3 py-1 bg-gray-500 text-white rounded"},{default:T(()=>[...e[22]||(e[22]=[L("Reset Zoom",-1)])]),_:1})])]),a("div",et,[a("div",tt,[a("div",{class:"relative p-4 bg-gray-100 min-w-[2000px] min-h-[2000px]",onDragover:e[2]||(e[2]=I(()=>{},["prevent"])),onDrop:xe,ref_key:"canvasRef",ref:P,id:"drawflow",style:H({transform:`scale(${k.value})`,transformOrigin:"0 0",width:k.value<1?`${100/k.value}%`:"100%",height:k.value<1?`${100/k.value}%`:"100%"})},[(y(!0),h(R,null,V(x,t=>(y(),h("div",{key:t.id,"data-area-id":t.id,class:"absolute rounded-xl border border-purple-400 bg-purple-200/30",style:H({left:t.x+"px",top:t.y+"px",width:t.width+"px",height:t.height+"px"}),onMousedown:s=>Te(t,s)},[a("div",nt,[$(a("input",{"onUpdate:modelValue":s=>t.name=s,class:"bg-purple-600 outline-none flex-1 rounded px-2"},null,8,lt),[[N,t.name]]),a("div",st,[C(n,{onClick:I(s=>Re(t),["stop"]),class:"text-white hover:text-blue-300 font-bold mr-2",title:"Export Area",icon:"heroicons:arrow-down-tray"},null,8,["onClick"]),C(n,{onClick:I(s=>he(t.id),["stop"]),class:"text-white hover:text-red-300 font-bold",title:"Delete Area",icon:"heroicons:trash"},null,8,["onClick"])])]),a("div",{class:"absolute bottom-0 right-0 w-4 h-4 bg-purple-600 cursor-se-resize rounded",onMousedown:I(s=>De(t,s),["stop"])},null,40,it)],44,ot))),128)),(y(),h("svg",at,[e[24]||(e[24]=a("defs",null,[a("marker",{id:"arrow",markerWidth:"10",markerHeight:"10",refX:"10",refY:"5",orient:"auto"},[a("path",{d:"M0,0 L10,5 L0,10 z",fill:"black"})])],-1)),(y(!0),h(R,null,V(b,t=>(y(),h("g",{key:t.id},[a("path",{d:t.path,stroke:"black","stroke-width":"2",fill:"none","marker-end":"url(#arrow)"},null,8,dt)]))),128)),v.active?(y(),h("path",{key:0,d:v.path,stroke:"gray","stroke-width":"2",fill:"none","stroke-dasharray":"6 4"},null,8,rt)):le("",!0)])),(y(!0),h(R,null,V(c,t=>(y(),h("div",{key:t.id,class:"absolute shadow-lg rounded border bg-white cursor-move",style:H({left:t.x+"px",top:t.y+"px",width:t.width+"px"}),draggable:"true",onDragstart:s=>ve(t,s),onDblclick:s=>K(t.id),"data-table-id":t.id},[a("div",ut,[a("div",pt,D(t.name||"table_"+t.id),1),a("div",mt,[C(n,{icon:"heroicons:document-duplicate",onClick:I(s=>we(t),["stop"]),title:"Duplicate",class:"text-xs px-2"},null,8,["onClick"]),C(n,{icon:"heroicons:trash",onClick:I(s=>ye(t.id),["stop"]),title:"Delete",class:"text-xs px-2"},null,8,["onClick"])])]),a("div",ft,[(y(!0),h(R,null,V(t.columns,(s,l)=>(y(),h("div",{key:l,class:"flex items-center gap-2","data-col-index":l},[a("span",vt,D(l+1),1),a("span",xt,D(s.name),1),a("span",ht,D(s.type||""),1),a("button",{onPointerdown:I(i=>_e(t.id,l,i),["stop","prevent"]),class:"w-4 h-4 rounded-full bg-blue-500",title:"Start relation"},null,40,yt)],8,bt))),128))])],44,ct))),128)),e[25]||(e[25]=a("div",{class:"absolute left-4 bottom-4"},null,-1))],36)]),a("aside",wt,[a("div",gt,[e[26]||(e[26]=a("label",{class:"text-sm font-semibold"},"AI Prompt",-1)),a("div",kt,[$(a("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.aiDescription=t),placeholder:"e.g. Customer table with id, name, email",class:"flex-1 p-2 border rounded"},null,512),[[N,o.aiDescription]]),a("button",{onClick:e[4]||(e[4]=t=>Ie(o.aiDescription)),class:"px-3 py-1 bg-yellow-500 text-white rounded"},"Generate")])]),f.value?(y(),h("div",Ct,[a("h2",$t,"Properties — "+D(f.value.name||"Untitled"),1),a("div",null,[e[27]||(e[27]=a("label",{class:"text-sm text-gray-600"},"Table Name",-1)),$(a("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>f.value.name=t),class:"w-full mt-1 p-2 border rounded"},null,512),[[N,f.value.name]])]),a("div",null,[e[28]||(e[28]=a("label",{class:"text-sm text-gray-600"},"Comment",-1)),$(a("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>f.value.comment=t),class:"w-full mt-1 p-2 border rounded"},null,512),[[N,f.value.comment]])]),a("div",null,[e[29]||(e[29]=a("label",{class:"text-sm text-gray-600"},"Is Published",-1)),$(a("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=t=>f.value.ispublished=t),class:"w-full mt-1 p-2 border rounded"},null,512),[[se,f.value.ispublished]])]),a("div",null,[e[30]||(e[30]=a("label",{class:"text-sm text-gray-600"},"Position",-1)),a("div",_t,[$(a("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=t=>f.value.x=t),class:"w-1/3 p-2 border rounded"},null,512),[[N,f.value.x,void 0,{number:!0}]]),$(a("input",{type:"number","onUpdate:modelValue":e[9]||(e[9]=t=>f.value.y=t),class:"w-1/3 p-2 border rounded"},null,512),[[N,f.value.y,void 0,{number:!0}]]),$(a("input",{type:"number","onUpdate:modelValue":e[10]||(e[10]=t=>f.value.width=t),class:"w-1/3 p-2 border rounded"},null,512),[[N,f.value.width,void 0,{number:!0}]])])]),a("div",null,[e[32]||(e[32]=a("label",{class:"text-sm text-gray-600"},"Columns",-1)),a("div",jt,[(y(!0),h(R,null,V(f.value.columns,(t,s)=>(y(),h("div",{key:s,class:"flex items-center gap-2"},[$(a("input",{"onUpdate:modelValue":l=>t.name=l,placeholder:"name",class:"flex-1 p-2 border rounded"},null,8,At),[[N,t.name]]),$(a("select",{"onUpdate:modelValue":l=>t.type=l,placeholder:"type",class:"w-36 p-2 border rounded"},[...e[31]||(e[31]=[Ye('<option value="auto">Auto Increment</option><option value="text">Text</option><option value="longtext">Long Text</option><option value="number">Number</option><option value="integer">Integer</option><option value="timestamp">Time stamp</option><option value="boolean">Boolean</option>',7)])],8,Nt),[[ze,t.type]]),$(a("input",{type:"checkbox","onUpdate:modelValue":l=>t.allownull=l,placeholder:"type",class:"w-36 p-2 border rounded"},null,8,St),[[se,t.allownull]]),$(a("input",{"onUpdate:modelValue":l=>t.default=l,placeholder:"default",class:"flex-1 p-2 border rounded"},null,8,Tt),[[N,t.default]]),a("button",{onClick:l=>ke(s),class:"px-2 py-1 bg-red-500 text-white rounded"},"-",8,Dt)]))),128)),a("div",Lt,[a("button",{onClick:e[11]||(e[11]=t=>ge()),class:"px-3 py-1 bg-blue-600 text-white rounded"},"Add Column"),a("button",{onClick:e[12]||(e[12]=t=>Le(f.value)),class:"px-3 py-1 bg-yellow-500 text-white rounded"}," AI Suggest Types ")])])]),a("div",null,[e[33]||(e[33]=a("label",{class:"text-sm text-gray-600"},"Raw JSON",-1)),$(a("textarea",{"onUpdate:modelValue":e[13]||(e[13]=t=>X.value=t),rows:"6",class:"w-full p-2 border rounded mt-1 text-xs font-mono"},null,512),[[N,X.value]])])])):le("",!0),a("div",Et,[e[34]||(e[34]=a("h3",{class:"font-semibold"},"Relations",-1)),b.length?(y(),h("div",It,[(y(!0),h(R,null,V(b,t=>(y(),h("div",{key:t.id,class:"flex items-center justify-between mt-2"},[a("div",Mt,D(t.from.table)+"."+D(t.from.col)+" ➜ "+D(t.to.table)+"."+D(t.to.col??"-"),1),a("div",Rt,[a("button",{onClick:s=>Ae(t.id),class:"px-2 py-1 bg-red-500 text-white rounded"},"Delete",8,Vt)])]))),128))])):(y(),h("div",Ut,"No relations"))])])])])}}});export{Zt as default};
