import{k as v,e as w,l as N,c as l,o as i,a as t,h as A,t as h,g as _,F as R,r as B,n as k,b as P}from"#entry";import{u as C}from"./Bs5g203e.js";import"./BJSp6O0t.js";function V(){const m=v([]),c=v(""),d=v(!1),u=C(),r="/media";async function p(e=""){d.value=!0;try{const o=await u.get(`${r}?path=${encodeURIComponent(e)}`);m.value=Array.isArray(o)?o:[],c.value=e}catch(o){console.error("Failed to load media",o)}finally{d.value=!1}}async function g(e){const o=new FormData;o.append("file",e),o.append("path",c.value),await u.post(`${r}/upload`,o),await p(c.value)}async function y(e){confirm(`Delete "${e.name}"?`)&&(await u.del(`${r}/delete?path=${encodeURIComponent(e.path)}`),await p(c.value))}async function x(e,o){await u.post(`${r}/rename`,JSON.stringify({oldPath:e,newName:o})),await p(c.value)}async function f(e){await u.post(`${r}/folder`,{path:c.value,folder:e}),await p(c.value)}return{files:m,currentPath:c,loading:d,loadMedia:p,uploadFile:g,deleteFile:y,renameFile:x,createFolder:f}}const L={class:"p-4 shadow-md"},O={class:"flex items-center justify-between mb-3"},S={class:"flex items-center space-x-2 cursor-pointer"},z={class:"text-sm italic"},E={class:"space-x-2"},J={key:0,class:"text-gray-500"},W={key:1,class:"grid grid-cols-6 gap-4"},q=["onDblclick"],G={class:"text-5xl"},H={key:0},K={key:1},Q={key:2},T={class:"text-xs text-center truncate w-full mt-1"},X={class:"flex space-x-1 mt-1 text-xs text-gray-500"},Y=["onClick"],Z=["onClick"],ee={class:"p-4 rounded-lg w-3/4 h-3/4 overflow-auto relative"},te={class:"font-semibold mb-2"},ne={key:0},ae=["src"],se={key:1,class:"text-sm whitespace-pre-wrap"},oe=w({__name:"MediaManager",setup(m){const{files:c,currentPath:d,loading:u,loadMedia:r,uploadFile:p,deleteFile:g,renameFile:y,createFolder:x}=V(),f=v(null),e=v(null),o=C();N(()=>r());function F(n){r(n)}function $(){if(!d.value)return;const n=d.value.split("/").slice(0,-1).join("/");r(n)}function M(n){const s=n.target.files?.[0];s&&p(s),f.value&&(f.value.value="")}async function U(n){const a=prompt("Rename to:",n.name);a&&a!==n.name&&await y(n.path,a)}async function j(){const n=prompt("Folder name:");n&&await x(n)}async function D(n){const a=await o.get(`/media/preview?path=${encodeURIComponent(n.path)}`);e.value=a}function I(n){return[".jpg",".jpeg",".png",".gif",".webp"].includes(n)}return(n,a)=>(i(),l("div",L,[t("div",O,[t("div",S,[t("button",{onClick:$,class:"px-2 py-1 bg-gray-200"},"â¬†"),t("span",z,"Path: "+h(_(d)||"/"),1)]),t("div",E,[t("input",{type:"file",ref_key:"fileInput",ref:f,class:"hidden",onChange:M},null,544),t("button",{class:"btn",onClick:a[0]||(a[0]=()=>f.value.click())},"ðŸ“¤ Upload"),t("button",{class:"btn",onClick:j},"ðŸ“ New Folder"),t("button",{class:"btn",onClick:a[1]||(a[1]=s=>_(r)(_(d)))},"ðŸ”„ Refresh")])]),_(u)?(i(),l("div",J,"Loading...")):(i(),l("div",W,[(i(!0),l(R,null,B(_(c),s=>(i(),l("div",{key:s.path,onDblclick:b=>s.type==="folder"?F(s.path):D(s),class:"flex flex-col items-center p-2 hover:bg-gray-100 cursor-pointer"},[t("div",G,[s.type=="folder"?(i(),l("span",H,"ðŸ“")):s.type?.startsWith("image")?(i(),l("span",K,"ðŸ–¼ï¸")):(i(),l("span",Q,"ðŸ“„"))]),t("span",T,h(s.name),1),t("div",X,[t("button",{onClick:k(b=>U(s),["stop"])},"âœï¸",8,Y),t("button",{onClick:k(b=>_(g)(s),["stop"])},"ðŸ—‘ï¸",8,Z)])],40,q))),128))])),e.value?(i(),l("div",{key:2,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:a[3]||(a[3]=k(s=>e.value=null,["self"]))},[t("div",ee,[t("button",{onClick:a[2]||(a[2]=s=>e.value=null),class:"absolute top-2 right-2 text-xl"},"âœ–"),t("h3",te,h(e.value.name),1),I(e.value.ext)?(i(),l("div",ne,[t("img",{src:e.value.content,class:"max-w-full max-h-[70vh] mx-auto"},null,8,ae)])):(i(),l("pre",se,h(e.value.content),1))])])):A("",!0)]))}}),le=Object.assign(oe,{__name:"MediaManager"}),ie={class:"min-h-screen bg-gray-50 dark:bg-black p-4"},ue=w({__name:"mediamgr",setup(m){return(c,d)=>(i(),l("div",ie,[P(le)]))}});export{ue as default};
