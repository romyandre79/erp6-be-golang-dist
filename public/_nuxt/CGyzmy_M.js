import{y as ce,r as E,z as be,o as S,b9 as Ye,a as Z,w as re,B as o,ak as n,an as P,a_ as h,Y as q,ay as J,aj as he,aL as xe,am as ve,u,ba as Je,b5 as oe,C as Ge,bb as Qe,bc as Xe,a$ as _e,b0 as we,aN as G,bd as Ze,b1 as ze,ao as $e,i as Ce,be as Ke,aM as Pe,aF as me,bf as et,d as Oe,ar as Ue,a4 as tt,b as at,ap as lt,al as Ie,b4 as st,bg as De,bh as nt,b3 as Se,J as rt}from"./DH2n3Tqk.js";import{ba as ot,bb as it,bc as ut,bd as dt,be as ct,bf as pt,bg as ft,bh as yt,bi as gt,bj as ht,bk as mt,n as se}from"#entry";import{u as ke}from"./C1AnPZyN.js";import{s as vt}from"./BXI2M5or.js";const bt=ce({props:{container:{type:Object,required:!0},renderChild:{type:Function,required:!0}},setup(t){const R=ke(),d=E(null);return be(async()=>{if(t.container.props.searchflow){const l=new FormData;l.append("flowname",t.container.props.searchflow),l.append("menu","admin"),l.append("search","true");try{const p=await R.post("admin/execute-flow",l);p.code===200&&(d.value=p.data.data)}catch(p){console.error(p)}}}),()=>{const l=t.container.children||[];return S(Ye,{title:t.container.props.title,description:t.container.props.description,icon:t.container.props.icon,orientation:t.container.props.orientation,spotlight:t.container.props.spotlight,"spotlight-color":t.container.props.spotlightcolor,class:t.container.props.class},{default:()=>l.map(p=>p.props?.key==="data"?S("div",{class:p.props.class},[p.props.text?S("div",d.value+" "+p.props.text):null]):t.renderChild(p))})}}}),kt=Object.assign(bt,{__name:"CardWrapper"}),xt={key:0,class:"mb-4 flex flex-wrap gap-2"},wt={class:"w-full h-96"},St=ce({__name:"ChartWrapper",props:{container:{type:Object,required:!0},renderChild:{type:Function,required:!0},formData:{type:Object,required:!0}},setup(t){ot([it,ut,dt,ct,pt,ft,yt,gt,ht,mt]),Ge(Qe,"light");const R=t,d=ke(),l=E({});function p(f){let m=[];if(!f)return m;for(const $ of f)$.props&&$.props.key&&m.push($.props.key),$.children&&(m=m.concat(p($.children)));return m}const A=Z(()=>p(R.container.children));async function y(){if(!R.container.props.searchflow)return;const f=new FormData;f.append("flowname",R.container.props.searchflow),f.append("menu","admin"),f.append("search","true"),A.value.forEach(m=>{R.formData[m]!==void 0&&f.append(m,R.formData[m])});try{const m=await d.post("admin/execute-flow",f);m.code===200&&(l.value=m.data.data)}catch(m){console.error(m)}}return be(()=>{y()}),re(()=>A.value.map(f=>R.formData[f]),()=>{y()},{deep:!0}),(f,m)=>(n(),o("div",{class:oe(t.container.props.class)},[t.container.children&&t.container.children.length>0?(n(),o("div",xt,[(n(!0),o(q,null,J(t.container.children,($,i)=>(n(),he(xe(t.renderChild($)),{key:i}))),128))])):P("",!0),h("div",wt,[ve(u(Je),{class:"chart",option:l.value,autoresize:""},null,8,["option"])])],2))}}),$t=Object.assign(Xe(St,[["__scopeId","data-v-04a9807a"]]),{__name:"ChartWrapper"});function Ct(){const{t}=_e();function R(d,l){if(!d.validated||!Array.isArray(d.validated))return!0;let p="";for(const A of d.validated){const[y,f]=A.split(":");switch(y.toLowerCase()){case"empty":(l==null||l==="")&&(p=t("INVALID_ENTRY_EMPTY",{entry:d.props.ext||d.props.key}));break;case"number":l!==""&&isNaN(Number(l))&&(p=t("INVALID_ENTRY_NUMBER",{entry:d.props.text||d.props.key}));break;case"email":l&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(l).toLowerCase())&&(p=t("INVALID_ENTRY_EMAIL",{entry:d.props.text||d.props.key}));break;case"min":l!=null&&l!==""&&(isNaN(Number(l))?String(l).length<Number(f)&&(p=t("INVALID_ENTRY_MIN_CHAR",{entry:d.props.text||d.props.key,value:f})):Number(l)<Number(f)&&(p=t("INVALID_ENTRY_MIN",{entry:d.props.text||d.props.key,value:f})));break;case"max":l!=null&&l!==""&&(isNaN(Number(l))?String(l).length<Number(f)&&(p=t("INVALID_ENTRY_MAX_CHAR",{entry:d.props.text||d.props.key,value:f})):Number(l)>Number(f)&&(p=t("INVALID_ENTRY_MAX",{entry:d.props.text||d.props.key,value:f})));break;case"regex":try{new RegExp(f).test(String(l||""))||(p=t("INVALID_ENTRY_FORMAT",{entry:d.props.text||d.props.key}))}catch{console.warn("Invalid regex:",f)}break}if(p)return p}return!0}return{validateField:R}}function Re(t,R){const d=E(1),l=E(1),p=E(""),A=E({}),y=E(t.pageSize||5),f=E(0),m=E([]),$=E(!1),i=E([]),F=N=>{const H=N[t.rowKey],L=i.value.indexOf(H);t.isInput&&(i.value=[]),L===-1?i.value.push(H):i.value.splice(L,1)},v=N=>i.value.includes(N[t.rowKey]),T=()=>{const N=m.value.map(L=>L[t.rowKey]),H=N.every(L=>i.value.includes(L));i.value=H?i.value.filter(L=>!N.includes(L)):Array.from(new Set([...i.value,...N]))};re(i,N=>{const H=m.value.filter(L=>N.includes(L[t.rowKey]));R("selection-change",H)},{deep:!0});const M=E(null);return{currentPage:d,totalPages:l,searchQuery:p,searchComplexQuery:A,pageSize:y,totalRecords:f,rowsData:m,loading:$,selectedKeys:i,toggleRowSelection:F,isSelected:v,toggleSelectAll:T,expandedKey:M,toggleExpand:N=>{const H=N[t.rowKey];M.value=M.value===H?null:H},isExpanded:N=>N&&M.value===N[t.rowKey],formatCellValue:(N,H)=>["boolean","bool","checkbox"].includes(N.type)?H?'<input type="checkbox" checked disabled class="checkbox checkbox-sm"/>':'<input type="checkbox" disabled class="checkbox checkbox-sm"/>':N.type==="currency"?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:2}).format(H||0):N.type==="number"?new Intl.NumberFormat("id-ID").format(H||0):H??"",handlePageSizeChange:N=>{d.value=1,N()},firstPage:N=>{d.value>0&&(d.value=1,N())},nextPage:N=>{d.value<l.value&&(d.value++,N())},prevPage:N=>{d.value>1&&(d.value--,N())},lastPage:N=>{l.value>0&&(d.value=l.value,N())}}}const Pt={key:0,class:"paging flex justify-center items-center gap-2"},Dt={class:"text-base-content/70"},At=["value"],Nt=["disabled"],Et=["disabled"],Ft=["disabled"],Tt=["disabled"],It=ce({__name:"TableControls",props:{currentPage:Number,totalPages:Number,pageSize:Number,loading:Boolean,enablePaging:Boolean,enablePageSize:Boolean,pageSizeOptions:{type:Array,default:()=>[5,10,20,50]}},emits:["update:pageSize","page-size-change","first-page","prev-page","next-page","last-page"],setup(t,{emit:R}){const d=t,l=R,p=Z({get:()=>d.pageSize,set:A=>l("update:pageSize",A)});return(A,y)=>t.enablePaging?(n(),o("div",Pt,[h("span",Dt," Page "+G(t.currentPage)+" / "+G(t.totalPages),1),t.enablePageSize?we((n(),o("select",{key:0,"onUpdate:modelValue":y[0]||(y[0]=f=>p.value=f),class:"border rounded px-2 py-1 text-sm",onChange:y[1]||(y[1]=f=>A.$emit("page-size-change"))},[(n(!0),o(q,null,J(t.pageSizeOptions,f=>(n(),o("option",{key:f,value:f},G(f),9,At))),128))],544)),[[Ze,p.value,void 0,{number:!0}]]):P("",!0),h("button",{class:"px-3 py-1 rounded-lg border hover:bg-base-100",disabled:t.currentPage===1||t.loading||t.totalPages===0,onClick:y[2]||(y[2]=f=>A.$emit("first-page"))}," << ",8,Nt),h("button",{class:"px-3 py-1 rounded-lg border hover:bg-base-100",disabled:t.currentPage===1||t.loading||t.totalPages===0,onClick:y[3]||(y[3]=f=>A.$emit("prev-page"))}," < ",8,Et),h("button",{class:"px-3 py-1 rounded-lg border hover:bg-base-100",disabled:t.currentPage===t.totalPages||t.loading,onClick:y[4]||(y[4]=f=>A.$emit("next-page"))}," > ",8,Ft),h("button",{class:"px-3 py-1 rounded-lg border hover:bg-base-100",disabled:t.currentPage===t.totalPages||t.loading,onClick:y[5]||(y[5]=f=>A.$emit("last-page"))}," >> ",8,Tt)])):P("",!0)}}),Le=Object.assign(It,{__name:"TableControls"}),_t={class:"w-full"},zt={class:"flex flex-col mb-3"},Kt={class:"font-semibold"},Ot={key:0,class:"mt-2"},Ut={key:0,class:"flex items-center gap-2"},Rt={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Lt=["onUpdate:modelValue","type","placeholder"],Vt={key:2},Mt=["onClick"],jt={class:"w-full rounded-xl overflow-x-auto"},Bt={class:"w-full"},qt={class:"text-sm uppercase font-semibold"},Wt={key:0,class:"px-4 py-3"},Ht=["checked"],Yt={key:1,class:"thead px-4 py-3"},Jt={key:2,class:"thead px-4 py-3 text-left"},Gt={key:0},Qt=["colspan"],Xt=["onClick","checked"],Zt={key:0,class:"px-4 py-3"},ea=["checked","onClick"],ta={key:1,class:"px-4 py-3"},aa=["onClick"],la=["innerHTML"],sa={key:2,class:"px-4 py-3"},na=["onClick"],ra={key:0},oa=["colspan"],ia={class:"rounded-lg w-full"},ua={key:1},da=["colspan"],ca=ce({__name:"TableDetailPagination",props:{title:String,endPoint:String,columns:{type:Array,required:!0},actions:{type:Array,default:()=>[]},tables:{type:Array,default:()=>[]},modals:{type:Array,default:()=>[]},rowActions:{type:Array,default:()=>[]},pageSize:{type:Number,default:5},pageSizeOptions:{type:Array,default:()=>[5,10,20,50]},enableSearch:{type:Boolean,default:!0},simpleSearch:{type:Boolean,default:!0},searchColumn:{type:Array,required:!1},enablePaging:{type:Boolean,default:!0},enablePageSize:{type:Boolean,default:!0},enableCheck:{type:Boolean,default:!0},method:{type:String,default:"GET"},rowKey:{type:String,default:"id"},selectedKeyData:{type:String,default:""},relationKey:{type:String,default:""},isInput:{type:Boolean,default:!1},isSelectAll:{type:Boolean,default:!1}},emits:["action","row-action","fetch-params","selection-change"],setup(t,{expose:R,emit:d}){const l=t,p=d,A=ke(),{currentPage:y,totalPages:f,searchQuery:m,searchComplexQuery:$,pageSize:i,totalRecords:F,rowsData:v,loading:T,toggleRowSelection:M,isSelected:z,toggleSelectAll:Q,toggleExpand:ne,isExpanded:ie,formatCellValue:te,handlePageSizeChange:pe,firstPage:fe,nextPage:ye,prevPage:N,lastPage:H}=Re(l,p);async function L(){T.value=!0;try{let I;if(l.method.toUpperCase()==="POST"){const D=new FormData;D.append("flowname",l.endPoint||""),D.append("menu","admin"),D.append("search","true"),D.append("page",y.value),D.append("rows",i.value);for(const b of l.columns)D.append(b.key,$.value[b.key]||"");l.selectedKeyData&&D.append(l.relationKey,l.selectedKeyData),I=await A.post("/admin/execute-flow",D)}else{const D={page:y.value,limit:i.value,search:m.value};p("fetch-params",D);const b=new URLSearchParams(D).toString();I=await A.get(`${l.endPoint}?${b}`)}I.code===200&&I.data?.data?(y.value=Number(I.data.page),v.value=I.data.data||[],F.value=Number(I.data.total)||Number(v.value.length),f.value=Number(I.data.meta?.totalPages)||Math.ceil(F.value/i.value)):(y.value=0,v.value=[],f.value=0,F.value=0)}catch(I){console.error(I),v.value=[]}finally{T.value=!1}}let X=E([]);function ue(I){if(!I)return null;const D=I.key||I.text||"table0";let b,B;function K(){for(const k of I.children)k.type==="columns"?b=k:k.type==="search"&&(B=k)}return K(),S("div",{key:D},[S(Ve,{columns:b?.children.map((k,w)=>({label:k.props.text||`Column ${w+1}`,key:k.props.key||`col${w+1}`,type:k.type||"text"}))??[],searchColumn:B?.children.map((k,w)=>({key:k.props.key||`col${w+1}`,type:k.type||"text",place:k.props.place||"search ..."}))??[],method:"POST",endPoint:I.props.source,simpleSearch:!1,class:I.props.class||"mb-4",rowKey:I.props.primary,enableSearch:!0,relationKey:I.props.relationkey,selectionKeyData:X.value,isInput:l.isInput,isSelectAll:!l.isInput,selectedKeyData:I.props.relationkey!=""&&X.value.length>0?X.value[0][I.props.relationkey]:"",onSelectionChange:k=>{X.value=k}})])}return be(()=>{L()}),R({refreshTable:L}),(I,D)=>(n(),o("div",_t,[h("div",zt,[h("h2",Kt,G(t.title),1),t.enableSearch?(n(),o("div",Ot,[t.simpleSearch?(n(),o("div",Ut,[we(h("input",{"onUpdate:modelValue":D[0]||(D[0]=b=>Ce(m)?m.value=b:null),type:"text",placeholder:"Search...",class:"border rounded px-3 py-2 text-sm w-full",onKeyup:$e(L,["enter"])},null,544),[[ze,u(m)]]),h("button",{class:"px-3 py-2 bg-blue-600 text-white rounded",onClick:L},"Cari")])):(n(),o("div",Rt,[(n(!0),o(q,null,J(t.searchColumn,(b,B)=>(n(),o("div",{key:B},[["text","number","email"].includes(b.type)?we((n(),o("input",{key:0,"onUpdate:modelValue":K=>u($)[b.key]=K,type:b.type,placeholder:`${I.$t(b.place.toUpperCase())}...`,class:"border rounded px-3 py-2 text-sm w-full",onKeyup:$e(L,["enter"])},null,40,Lt)),[[Ke,u($)[b.key]]]):P("",!0)]))),128))])),t.actions&&t.actions.length?(n(),o("div",Vt,[(n(!0),o(q,null,J(t.actions,(b,B)=>(n(),o("button",{key:B,onClick:K=>I.$emit("action",b)},[b.icon?(n(),o("i",{key:0,class:oe(["mr-1",b.icon])},null,2)):P("",!0),Pe(" "+G(b.label),1)],8,Mt))),128))])):P("",!0)])):P("",!0)]),h("div",jt,[h("table",Bt,[h("thead",qt,[h("tr",null,[t.enableCheck&&t.isSelectAll?(n(),o("th",Wt,[h("input",{type:"checkbox",class:"checkbox checkbox-sm",checked:u(v).length>0&&u(v).every(b=>u(z)(b)),onChange:D[1]||(D[1]=(...b)=>u(Q)&&u(Q)(...b))},null,40,Ht)])):P("",!0),t.tables?.length>1&&l.isInput==!1?(n(),o("th",Yt)):P("",!0),(n(!0),o(q,null,J(t.columns,b=>(n(),o("th",{key:b.key||b,class:"thead px-4 py-3 text-left tracking-wide"},G(b.text||b.label),1))),128)),t.rowActions&&t.rowActions.length?(n(),o("th",Jt,"Actions")):P("",!0)])]),h("tbody",null,[u(T)?(n(),o("tr",Gt,[h("td",{colspan:t.columns.length+(t.rowActions?.length?1:0)+1,class:"p-4 text-center"},[...D[8]||(D[8]=[h("span",{class:"loading loading-spinner loading-md"},null,-1)])],8,Qt)])):P("",!0),(n(!0),o(q,null,J(u(v),(b,B)=>(n(),o(q,{key:B},[h("tr",{class:"transition-colors duration-200",onClick:me(K=>u(M)(b),["stop"]),checked:u(z)(b)},[t.enableCheck?(n(),o("td",Zt,[h("input",{type:"checkbox",class:"checkbox checkbox-sm",checked:u(z)(b),onClick:me(K=>u(M)(b),["stop"])},null,8,ea)])):P("",!0),t.tables?.length>1&&l.isInput==!1?(n(),o("td",ta,[h("button",{onClick:me(K=>u(ne)(b),["stop"])},G(u(ie)(b)?"-":"+"),9,aa)])):P("",!0),(n(!0),o(q,null,J(t.columns,K=>(n(),o("td",{key:K.key||K,class:"px-4 py-3 text-sm cursor-pointer"},[h("span",{innerHTML:u(te)(K,b[K.key||K])},null,8,la)]))),128)),t.rowActions&&t.rowActions.length?(n(),o("td",sa,[(n(!0),o(q,null,J(t.rowActions,(K,k)=>(n(),o("button",{key:k,class:oe(["btn btn-xs mr-1",K.class||"btn-outline"]),onClick:w=>I.$emit("row-action",{action:K,row:b})},[K.icon?(n(),o("i",{key:0,class:oe(["mr-1",K.icon])},null,2)):P("",!0),Pe(" "+G(K.label),1)],10,na))),128))])):P("",!0)],8,Xt),u(ie)(b)?(n(),o("tr",ra,[h("td",{colspan:t.columns.length+2},[(n(!0),o(q,null,J(t.tables,(K,k)=>(n(),o("div",ia,[k>0?(n(),he(xe(ue(K)),{key:0})):P("",!0)]))),256))],8,oa)])):P("",!0)],64))),128)),!u(T)&&u(v).length===0?(n(),o("tr",ua,[h("td",{colspan:t.columns.length+(t.rowActions?.length?1:0),class:"text-center p-4 text-gray-400"}," No data available ",8,da)])):P("",!0)])]),ve(Le,{pageSize:u(i),"onUpdate:pageSize":D[2]||(D[2]=b=>Ce(i)?i.value=b:null),currentPage:u(y),totalPages:u(f),loading:u(T),enablePaging:t.enablePaging,enablePageSize:t.enablePageSize,pageSizeOptions:t.pageSizeOptions,onPageSizeChange:D[3]||(D[3]=b=>u(pe)(L)),onFirstPage:D[4]||(D[4]=b=>u(fe)(L)),onPrevPage:D[5]||(D[5]=b=>u(N)(L)),onNextPage:D[6]||(D[6]=b=>u(ye)(L)),onLastPage:D[7]||(D[7]=b=>u(H)(L))},null,8,["pageSize","currentPage","totalPages","loading","enablePaging","enablePageSize","pageSizeOptions"])])]))}}),pa=Object.assign(ca,{__name:"TableDetailPagination"}),fa={class:"w-full"},ya={class:"flex flex-col sm:flex-row mb-3"},ga={class:"text-2xl font-semibold"},ha={key:0,class:"mb-4"},ma={key:0,class:"flex items-center gap-2"},va={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ba=["onUpdate:modelValue","type","placeholder"],ka={key:2},xa=["onClick"],wa={class:"w-full rounded-xl overflow-x-auto"},Sa={class:"w-full"},$a={class:"text-sm uppercase font-semibold"},Ca={key:0,class:"px-4 py-3"},Pa=["checked"],Da={key:1,class:"thead px-4 py-3"},Aa={key:2,class:"thead px-4 py-3"},Na={key:3,class:"thead px-4 py-3 text-left"},Ea={key:0},Fa=["colspan"],Ta=["onClick","checked"],Ia={key:0,class:"px-4 py-3"},_a=["checked","onClick"],za={key:1,class:"px-4 py-3"},Ka=["onClick"],Oa=["innerHTML"],Ua={key:2,class:"px-4 py-3"},Ra=["onClick"],La={key:0},Va=["colspan"],Ma={class:"rounded-lg w-full"},ja={key:1},Ba=["colspan"],qa=ce({__name:"TablePagination",props:{title:String,endPoint:String,columns:{type:Array,required:!0},actions:{type:Array,default:()=>[]},tables:{type:Array,default:()=>[]},modals:{type:Array,default:()=>[]},rowActions:{type:Array,default:()=>[]},pageSize:{type:Number,default:5},pageSizeOptions:{type:Array,default:()=>[5,10,20,50]},enableSearch:{type:Boolean,default:!0},simpleSearch:{type:Boolean,default:!0},searchColumn:{type:Array,required:!1},enablePaging:{type:Boolean,default:!0},enablePageSize:{type:Boolean,default:!0},enableCheck:{type:Boolean,default:!0},method:{type:String,default:"GET"},rowKey:{type:String,default:"id"},relationKey:{type:String,default:"id"},isInput:{type:Boolean,default:!1},isSelectAll:{type:Boolean,default:!1},isExpand:{type:Boolean,default:!1},isDetail:{type:Boolean,default:!1},selectedKeyData:{type:String,default:""}},emits:["action","row-action","fetch-params","selection-change"],setup(t,{expose:R,emit:d}){const l=t,p=d,A=ke(),{currentPage:y,totalPages:f,searchQuery:m,searchComplexQuery:$,pageSize:i,totalRecords:F,rowsData:v,loading:T,toggleRowSelection:M,isSelected:z,toggleSelectAll:Q,expandedKey:ne,toggleExpand:ie,isExpanded:te,formatCellValue:pe,handlePageSizeChange:fe,firstPage:ye,nextPage:N,prevPage:H,lastPage:L}=Re(l,p),X=E(l.relationKey),ue=E(l.selectedKeyData),I=E(l.isDetail);function D(w,C){X.value=w,ue.value=C,B()}function b(w){I.value=w}async function B(){T.value=!0;try{let w;if(l.method.toUpperCase()==="POST"){const C=new FormData;C.append("flowname",l.endPoint||""),C.append("menu","admin"),C.append("search","true"),C.append("page",y.value),C.append("rows",i.value);for(const x of l.columns)C.append(x.key,$.value[x.key]||"");X.value&&C.append(X.value,ue.value),w=await A.post("/admin/execute-flow",C)}else{const C={page:y.value,limit:i.value,search:m.value};p("fetch-params",C);const x=new URLSearchParams(C).toString();w=await A.get(`${l.endPoint}?${x}`)}w.code===200&&w.data?.data?(y.value=Number(w.data.page),v.value=w.data.data||[],F.value=Number(w.data.total)||Number(v.value.length),f.value=Number(w.data.meta?.totalPages)||Math.ceil(F.value/i.value)):(y.value=0,v.value=[],f.value=0,F.value=0)}catch(w){console.error(w),v.value=[]}finally{T.value=!1}}let K=E([]);function k(w){if(!w)return null;const C=w.key||w.text||"table0";let x,ae;function j(){for(const W of w.children)W.type==="columns"?x=W:W.type==="search"&&(ae=W)}return j(),S("div",{key:C},[S(pa,{columns:x?.children.map((W,de)=>({label:W.props.text||`Column ${de+1}`,key:W.props.key||`col${de+1}`,type:W.type||"text"}))??[],searchColumn:ae?.children.map((W,de)=>({key:W.props.key||`col${de+1}`,type:W.type||"text",place:W.props.place||"search ..."}))??[],method:"POST",endPoint:w.props.source,simpleSearch:!1,class:w.props.class||"mb-4",rowKey:w.props.primary,enableSearch:!0,title:w.props.text,relationKey:w.props.relationkey,selectionKeyData:K.value,isInput:!0,enableCheck:!1,isSelectAll:!1,selectedKeyData:w.props.relationkey!=""&&ne.value!=null?ne.value:"",onSelectionChange:W=>{K.value=W}})])}return be(()=>{B()}),R({refreshTable:B,setData:D,setDataIsDetail:b}),(w,C)=>(n(),o("div",fa,[h("div",ya,[h("h2",ga,G(t.title),1),t.enableSearch?(n(),o("div",ha,[t.simpleSearch?(n(),o("div",ma,[we(h("input",{"onUpdate:modelValue":C[0]||(C[0]=x=>Ce(m)?m.value=x:null),type:"text",placeholder:"Search...",class:"border rounded px-3 py-2 text-sm w-full",onKeyup:$e(B,["enter"])},null,544),[[ze,u(m)]]),h("button",{class:"px-3 py-2 bg-blue-600 text-white rounded",onClick:B},"Cari")])):(n(),o("div",va,[(n(!0),o(q,null,J(t.searchColumn,(x,ae)=>(n(),o("div",{key:ae},[["text","number","email"].includes(x.type)?we((n(),o("input",{key:0,"onUpdate:modelValue":j=>u($)[x.key]=j,type:x.type,placeholder:`${w.$t(x.place.toUpperCase())}...`,class:"border rounded px-3 py-2 text-sm w-full",onKeyup:$e(B,["enter"])},null,40,ba)),[[Ke,u($)[x.key]]]):P("",!0)]))),128))])),t.actions&&t.actions.length?(n(),o("div",ka,[(n(!0),o(q,null,J(t.actions,(x,ae)=>(n(),o("button",{key:ae,onClick:j=>w.$emit("action",x)},[x.icon?(n(),o("i",{key:0,class:oe(["mr-1",x.icon])},null,2)):P("",!0),Pe(" "+G(x.label),1)],8,xa))),128))])):P("",!0)])):P("",!0)]),h("div",wa,[h("table",Sa,[h("thead",$a,[h("tr",null,[t.enableCheck&&t.isSelectAll?(n(),o("th",Ca,[h("input",{type:"checkbox",class:"checkbox checkbox-sm",checked:u(v).length>0&&u(v).every(x=>u(z)(x)),onChange:C[1]||(C[1]=(...x)=>u(Q)&&u(Q)(...x))},null,40,Pa)])):(n(),o("th",Da)),t.isExpand==!0?(n(),o("th",Aa)):P("",!0),(n(!0),o(q,null,J(t.columns,x=>(n(),o("th",{key:x.key||x,class:"thead px-4 py-3 text-left tracking-wide"},G(x.text||x.label),1))),128)),t.rowActions&&t.rowActions.length?(n(),o("th",Na,"Actions")):P("",!0)])]),h("tbody",null,[u(T)?(n(),o("tr",Ea,[h("td",{colspan:t.columns.length+(t.rowActions?.length?1:0)+1,class:"p-4 text-center"},[...C[8]||(C[8]=[h("span",{class:"loading loading-spinner loading-md"},null,-1)])],8,Fa)])):P("",!0),(n(!0),o(q,null,J(u(v),(x,ae)=>(n(),o(q,{key:ae},[h("tr",{class:"transition-colors duration-200",onClick:me(j=>u(M)(x),["stop"]),checked:u(z)(x)},[l.enableCheck?(n(),o("td",Ia,[l.isSelectAll?(n(),o("input",{key:0,type:"checkbox",class:"checkbox checkbox-sm",checked:u(z)(x),onClick:me(j=>u(M)(x),["stop"])},null,8,_a)):P("",!0)])):P("",!0),l.isExpand==!0?(n(),o("td",za,[h("button",{onClick:me(j=>u(ie)(x),["stop"])},G(u(te)(x)?"^":">"),9,Ka)])):P("",!0),(n(!0),o(q,null,J(t.columns,j=>(n(),o("td",{key:j.key||j,class:"px-4 py-3 text-sm cursor-pointer"},[h("span",{innerHTML:u(pe)(j,x[j.key||j])},null,8,Oa)]))),128)),t.rowActions&&t.rowActions.length?(n(),o("td",Ua,[(n(!0),o(q,null,J(t.rowActions,(j,W)=>(n(),o("button",{key:W,class:oe(["btn btn-xs mr-1",j.class||"btn-outline"]),onClick:de=>w.$emit("row-action",{action:j,row:x})},[j.icon?(n(),o("i",{key:0,class:oe(["mr-1",j.icon])},null,2)):P("",!0),Pe(" "+G(j.label),1)],10,Ra))),128))])):P("",!0)],8,Ta),u(te)(x)&&t.isExpand==!0?(n(),o("tr",La,[h("td",{colspan:t.columns.length+2},[(n(!0),o(q,null,J(t.tables,(j,W)=>(n(),o("div",Ma,[W>0?(n(),he(xe(k(j)),{key:0})):P("",!0)]))),256))],8,Va)])):P("",!0)],64))),128)),!u(T)&&u(v).length===0?(n(),o("tr",ja,[h("td",{colspan:t.columns.length+(t.rowActions?.length?1:0),class:"text-center p-4 text-gray-400"}," No data available ",8,Ba)])):P("",!0)])]),ve(Le,{pageSize:u(i),"onUpdate:pageSize":C[2]||(C[2]=x=>Ce(i)?i.value=x:null),currentPage:u(y),totalPages:u(f),loading:u(T),enablePaging:t.enablePaging,enablePageSize:t.enablePageSize,pageSizeOptions:t.pageSizeOptions,onPageSizeChange:C[3]||(C[3]=x=>u(fe)(B)),onFirstPage:C[4]||(C[4]=x=>u(ye)(B)),onPrevPage:C[5]||(C[5]=x=>u(H)(B)),onNextPage:C[6]||(C[6]=x=>u(N)(B)),onLastPage:C[7]||(C[7]=x=>u(L)(B))},null,8,["pageSize","currentPage","totalPages","loading","enablePaging","enablePageSize","pageSizeOptions"])])]))}}),Ve=Object.assign(qa,{__name:"TablePagination"}),Wa={class:"flex flex-col mb-3"},Ha={key:0,class:"mb-1 text-gray-400 text-sm font-medium"},Ya={key:1,class:"text-xs text-red-500 mt-1"},Ja=ce({__name:"FormSelect",props:{component:{},formData:{},validationErrors:{},validateField:{type:Function}},setup(t){const R=t,d=ke(),{component:l,formData:p,validationErrors:A,validateField:y}=R;l.key in p.value||(p.value[l.key]="");const f=E([]),m=E(!1);be(async()=>{if(l.source){m.value=!0;try{let i=R.component.source?.split(",");if(i.length==1){const F=new FormData;F.append("flowname",l.source),F.append("menu","admin"),F.append("search","true");const v=await d.post("admin/execute-flow",F);if(v.code===200&&Array.isArray(v.data?.data)){const T=l.label||"label",M=l.valueField||l.key||"value";f.value=v.data.data.map(z=>({label:z[T],id:z[M]}))}else console.error("Gagal ambil data untuk select:",v?.message)}else for(let F=0;F<i.length;F++){const v=i[F];f.value.push({label:v,id:v})}}catch(i){console.error("Error fetch data select:",i)}m.value=!1}});const $=Z({get:()=>p.value[l.key],set:i=>{p.value[l.key]=typeof i=="string"&&!isNaN(Number(i))?Number(i):i,y(l,i)}});return re(f,i=>{if(!i.length)return;const F=p.value[l.key];F!=null&&F!==""&&(i.some(T=>T.id==F)?p.value[l.key]=F:console.warn(`⚠️ Value '${F}' tidak ditemukan di options untuk ${l.key}`))},{immediate:!0}),re(()=>p.value[l.key],i=>{f.value.length>0&&i!=null&&i!==""&&(f.value.some(v=>v.id==i)||console.warn(`⚠️ Value '${i}' belum ada di options saat ini untuk ${l.key}`))}),(i,F)=>{const v=et;return n(),o("div",Wa,[u(l).text?(n(),o("label",Ha,G(i.$t(u(l).text.toUpperCase())),1)):P("",!0),ve(v,{modelValue:$.value,"onUpdate:modelValue":F[0]||(F[0]=T=>$.value=T),items:f.value,"value-key":"id",loading:m.value,placeholder:u(l).place||i.$t("CHOOSE"),class:"w-full px-3 py-2 focus:ring focus:ring-blue-200 outline-none border-gray-300",disabled:m.value},null,8,["modelValue","items","loading","placeholder","disabled"]),u(A)[u(l).key]?(n(),o("span",Ya,G(u(A)[u(l).key]),1)):P("",!0)])}}}),Ga=Object.assign(Ja,{__name:"FormSelect"}),Qa={class:"w-full max-w-2xl mx-auto p-6 border rounded-lg shadow bg-white"},Xa={class:"w-full bg-gray-200 h-2 rounded mb-6"},Za={class:"flex justify-between mb-6"},el={class:"text-xs mt-1"},tl={class:"mb-6"},al={key:0,class:"text-red-500 mb-4"},ll={class:"flex justify-between"},sl=["disabled"],nl={__name:"FormWizard",props:{steps:{type:Array,required:!0},saveKey:{type:String,default:"wizard-data"}},emits:["finish","changeStep","autosave"],setup(t,{emit:R}){const d=t,l=R,p=E(0),A=E(null),y=Oe(f()||{});re(y,()=>{localStorage.setItem(d.saveKey,JSON.stringify(y)),l("autosave",y)},{deep:!0});function f(){{const T=localStorage.getItem(d.saveKey);if(T)return JSON.parse(T)}return null}function m(){A.value=null;const T=d.steps[p.value].schema;for(const M of T){const z=y[M.key];if(M.rules?.includes("required")&&(!z||z===""))return A.value=`${M.label} wajib diisi`,!1;if(M.rules?.includes("email")&&!/\S+@\S+\.\S+/.test(z))return A.value=`${M.label} tidak valid`,!1}return!0}function $(){m()&&(p.value++,l("changeStep",p.value))}function i(){p.value--,l("changeStep",p.value)}function F(){m()&&l("finish",y)}const v=Z(()=>p.value/(d.steps.length-1)*100);return(T,M)=>(n(),o("div",Qa,[h("div",Xa,[h("div",{class:"h-2 bg-blue-600 rounded transition-all",style:Ue({width:v.value+"%"})},null,4)]),h("div",Za,[(n(!0),o(q,null,J(t.steps,(z,Q)=>(n(),o("div",{key:Q,class:"text-center flex-1"},[h("div",{class:oe(["w-10 h-10 mx-auto flex items-center justify-center rounded-full border font-bold transition",Q===p.value?"bg-blue-600 text-white border-blue-600":"border-gray-400 text-gray-500"])},G(Q+1),3),h("p",el,G(z.title),1)]))),128))]),h("div",tl,[tt(T.$slots,"default",{step:p.value,schema:t.steps[p.value].schema,state:y})]),A.value?(n(),o("p",al,G(A.value),1)):P("",!0),h("div",ll,[h("button",{class:"px-4 py-2 bg-gray-300 rounded",disabled:p.value===0,onClick:i},"Back",8,sl),p.value<t.steps.length-1?(n(),o("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:$}," Next ")):(n(),o("button",{key:1,class:"px-4 py-2 bg-green-600 text-white rounded",onClick:F},"Finish"))])]))}},rl=Object.assign(nl,{__name:"FormWizard"}),ol={key:0,class:"mt-2 w-full bg-gray-200 h-2 rounded overflow-hidden"},il={class:"flex gap-2"},ul=ce({__name:"FormRender",props:{title:{type:String,default:""},menuName:{type:String,default:""},schema:{type:[Object,String],required:!0},formType:{type:String,default:"form"}},emits:[],setup(t,{emit:R}){const{t:d}=_e(),l=t,p=E(""),A=E(""),y=at({}),f=E(),m=ke(),$=vt();let i=E([]);const F=R,v=Z(()=>typeof l.schema=="string"?JSON.parse(l.schema):l.schema);function T(e,s){let a=[];if(Array.isArray(e)){for(const r of e)a.push(...T(r,s));return a}if(!e||typeof e!="object")return[];if(e.type===s&&a.push(e),Array.isArray(e.children))for(const r of e.children)a.push(...T(r,s));return a}const M=Z(()=>T(v.value,"table")),z=Z(()=>T(v.value,"modal"));re(()=>i.value,e=>{!e||e.length===0||M.value.forEach(s=>{s.key!=="table0"&&(s.selectionKeyData=e[0][s.relationkey]+"")})},{deep:!0}),re(z,async e=>{await rt();for(const s of Object.keys(y))delete y[s];e?.forEach(s=>{y[s.key]=E(!1)})},{immediate:!0});const Q=Z(()=>z.value?z.value.slice(1).map(e=>({...e})):[]),ne=E({});re(Q,e=>{e.forEach(s=>{ne.value[s.key]||(s.value&&Array.isArray(s.value)?ne.value[s.key]=[...s.value]:ne.value[s.key]=[{}])})},{immediate:!0});function ie(e){if(y[e]){y[e].value=!0,p.value="New Data",A.value="";const s=te();f.value.setData(s,0)}else console.warn("❌ Modal not found:",e)}function te(){let e;return v.value.forEach(s=>{s.type=="master"&&(e=s)}),e.props.primary||null}async function pe(e){const s=z.value.find(r=>r.props.key===e),a=s&&e.toLowerCase().includes("detail");if(console.log("edit debug:",{key:e,isDetailModal:a,modalFound:!!s}),a){e.replace("modal","table").replace("form","");let r;v.value.forEach(_=>{_.type=="action"&&(r=_)});const g=r?.props?.onGetDetail||[],V=z.value.filter(_=>_.props.key.toLowerCase().includes("detail")).findIndex(_=>_.props.key===e),le=g[V];if(le&&i.value.length>0){p.value="Edit Data",A.value="",y[e].value=!0;const _=new FormData;_.append("flowname",le),_.append("menu","admin"),_.append("search","true");const O=i.value[0];for(const U in O)O[U]!==null&&O[U]!==void 0&&typeof O[U]!="object"&&_.append(U,O[U]);try{const U=await m.post("admin/execute-flow",_);if(U.code==200){const Y=U.data.data;for(const Te in Y)k.value[Te]=Y[Te]}else U.code==401&&U.error=="INVALID_TOKEN"&&se("/login")}catch(U){console.error("Gagal ambil data:",U)}}}else{const r=ee("get");if(r&&i.value.length>0){const g=te();p.value="Edit Data",A.value="",y[e].value=!0;const c=new FormData;c.append("flowname",r),c.append("menu","admin"),c.append("search","true"),c.append(g,i.value[0][g]);try{const V=await m.post("admin/execute-flow",c);if(V.code==200){const le=V.data.data;for(const _ in le)k.value[_]=le[_];f.value.setData(g,i.value[0][g])}else V.code==401&&V.error=="INVALID_TOKEN"&&se("/login")}catch(V){console.error("Gagal ambil data:",V)}}}}function fe(e){try{const s=te();i.value&&i.value.length>0&&i.value[0][s]&&f.value.setData(s,i.value[0][s]),f.value.setDataIsDetail(!1)}catch(s){console.error("Error closing modal:",s)}finally{y[e]&&(y[e].value=!1)}}async function ye(e){const s=ee("purge");if(console.log("del table ",f.value[e]),s&&i.value.length>0){let a=new FormData;for(let r=0;r<i.value.length;r++){a.append("flowname",s),a.append("menu","admin"),a.append("search","true"),a.append(v.value.primary,i.value[r][v.value.primary]);try{const g=await m.post("admin/execute-flow",a);g?.code==200?f.value.refreshTable():g?.code==401&&g?.error=="INVALID_TOKEN"&&se("/login")}catch(g){console.error("Gagal hapus data:",g)}}}}async function N(e){let s="";if(e=="pdf"?s=ee("pdf"):(e=="xlsx"||e=="xls")&&(s=ee("xls")),s){let a=new FormData;a.append("flowname",s),a.append("menu","admin"),a.append("search","true");for(let r=0;r<i?.length;r++)a.append(v.value.primary+"["+r+"]",i[r][v.value.primary]);await m.donlotFile("/admin/execute-flow",a,l.menuName+"."+e)}}async function H(){let e=new FormData;e.append("menu",l.menuName),await m.donlotFile("/admin/down-template",e,l.menuName+".xlsx")}function L(e){if(e.includes("form-designer")&&i.value.length===0){$.add({title:"Error",description:"Please select one row",color:"error"});return}else if(e.includes("widget-designer")&&i.value.length===0){$.add({title:"Error",description:"Please select one row",color:"error"});return}else if(e.includes("workflow-designer")&&i.value.length===0){$.add({title:"Error",description:"Please select one row",color:"error"});return}else if(e.includes("theme-editor")&&i.value.length===0){$.add({title:"Error",description:"Please select one row",color:"error"});return}else if(e.includes("db-designer")&&i.value.length===0){$.add({title:"Error",description:"Please select one row",color:"error"});return}else e.includes("form-designer")&&i.value.length>0?se(e+"/"+i.value[0].menuname):e.includes("widget-designer")&&i.value.length>0?se(e+"/"+i.value[0].widgetname):e.includes("workflow-designer")&&i.value.length>0?se(e+"/"+i.value[0].wfname):e.includes("theme-editor")&&i.value.length>0?se(e+"/"+i.value[0].themename):e.includes("db-designer")&&i.value.length>0?se(e+"/"+i.value[0].objectname):se(e)}const X=E(0),ue=E(null),I=E(!1),D=E(null);function b(){B()}function B(){D.value?.click()}async function K(e){const s=e.target;if(!s.files||s.files.length===0)return;const a=s.files?.[0];if(!a)return;if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(a.type)){$.add({title:"Error",description:"Hanya file Excel yang diizinkan (.xls / .xlsx)",color:"red"}),s.value="";return}ue.value=a;const g=ee("upload");if(!g){$.add({title:"Error",description:"Upload flow not defined."});return}const c=new FormData;c.append("flowname",g),c.append("menu","admin"),c.append("search","false"),c.append("file-modules",a);try{I.value=!0,X.value=0;const V=await m.post("admin/execute-flow",c);V.code===200?($.add({title:"Upload Success",description:V.message||"File uploaded successfully."}),X.value=0,ue.value=null,f.value?.refreshTable?.()):$.add({title:"Upload Failed",description:V.message||"Unknown error."})}catch(V){console.error("Upload error:",V),$.add({title:"Error",description:"Failed to upload file."})}finally{I.value=!1,s.value=""}}let k=E({});const w=Oe({}),{validateField:C}=Ct();function x(e){switch((e.type||"").toLowerCase()){case"callother":return W(e);case"title":return S("h1",{class:e.props.class},d(e.props.text));case"subtitle":return S("h2",{class:e.props.class},d(e.props.text));case"label":{const a=e.props?.text||"";return S("label",{class:`block mb-1 font-medium ${e.props?.class??""}`,for:e.props?.for??null},d(a.toUpperCase())+required)}case"longtext":{e.props.key in k.value||(k.value[e.props.key]="");const a=Z({get:()=>k.value[e.props.key],set:r=>{k.value[e.props.key]=r}});return S("div",{class:[e.props.class,"flex flex-col mb-3"]},[e.type!="hidden"?e.props.text?S("label",{class:"mb-1 font-medium"},d(e.props.text.toUpperCase())):null:"",S("textarea",{type:e.type,class:"border rounded px-3 py-2 focus:ring focus:ring-blue-200 outline-none "+(w[e.props.key]?"border-red-500":"border-gray-300")+" "+(e.type==="number"?"text-right":""),placeholder:d(e.props.place?.toUpperCase())||"",maxlength:e.length,onInput:r=>r.target.value,value:a.value}),w[e.props.key]?S("span",{class:"text-red-500 mt-1"},w[e.props.key]):null])}case"image":const s=Z({get:()=>k.value[e.props.key]||e.props.src,set:a=>{k.value[e.props.key]=a}});return S("div",{class:[e.props.class,"flex flex-col mb-3"]},[e.props.isinput?[e.type!="hidden"&&e.props.text?S("label",{class:"text-sm mb-1 font-medium text-gray-400"},d(e.props.text.toUpperCase())):null,S("input",{type:"file",accept:"image/*",class:"border rounded px-3 py-2 focus:ring focus:ring-blue-200 outline-none "+(w[e.props.key]?"border-red-500":"border-gray-300"),onChange:a=>{const r=a.target.files?.[0];if(!r)return;const g=new FileReader;g.onload=()=>{s.value=g.result},g.readAsDataURL(r)}}),s.value?S("img",{src:s.value,class:"mt-2 w-32 h-auto rounded border"}):null,w[e.props.key]?S("span",{class:"text-xs text-red-500 mt-1"},w[e.props.key]):null]:s.value?S("img",{src:s.value,class:"w-32 h-auto rounded border"}):null]);case"text":case"hidden":case"password":case"number":{e.props.key in k.value||(k.value[e.props.key]="");const a=Z({get:()=>k.value[e.props.key],set:r=>{k.value[e.props.key]=r}});return S("div",{class:[e.props.class,"flex flex-col mb-3"]},[e.type!="hidden"?e.props.text?S("label",{class:"text-sm mb-1 font-medium text-gray-400"},d(e.props.text.toUpperCase())):null:"",S("input",{type:e.type,class:"border rounded px-3 py-2 focus:ring focus:ring-blue-200 outline-none"+(w[e.props.key]?"border-red-500":"border-gray-300")+" "+(e.type==="number"?"text-right":""),placeholder:e.props.place?d(e.props.place?.toUpperCase()):"",maxlength:e.length,value:a.value,onInput:r=>a.value=r.target.value}),w[e.props.key]?S("span",{class:"text-xs text-red-500 mt-1"},w[e.props.key]):null])}case"select":return e.props.key in k.value||(k.value[e.props.key]=""),S(Ga,{class:e.props.class,component:e.props,formData:k,validationErrors:w,validateField:C});case"bool":case"boolean":{e.props.key in k.value||(k.value[e.props.key]=!1);const a=Z({get:()=>k.value[e.props.key],set:r=>{k.value[e.props.key]=r,C(e.props,r)}});return S("div",{class:[e.props.class,"flex items-center mb-3 space-x-2"]},[S("input",{type:"checkbox",checked:a.value,onChange:r=>a.value=r.target.checked,class:"w-4 h-4 rounded focus:ring-blue-500 focus:ring-2"}),S("label",{class:"cursor-pointer"},d(e.props.text.toUpperCase())||"")])}case"button":return S(De,{class:[e.props.class,"rounded px-4 py-2 mr-2 transition mb-3"],icon:e.props.icon||"",onClick:async()=>{const a=e.props.onClick.toLowerCase();if(a==="oncreate")Ae()?await Be():$.add({title:"Error",description:"Error Validation",color:"error"});else if(a==="onupdate")Ae()?await qe():$.add({title:"Error",description:"Error Validation",color:"error"});else if(a==="ondelete")await We();else if(a.startsWith("open")){const r=a.replace("open:","");ie(r);return}else if(a.startsWith("edit")){const r=a.replace("edit:","");pe(r);return}else if(a.startsWith("navigate")){const r=a.replace("navigate:","");L(r);return}else if(a.startsWith("downform")){const r=a.replace("downform:","");N(r);return}else if(a.startsWith("deletedata")){const r=a.replace("deletedata:","");ye(r);return}else if(a.startsWith("upload")){b();return}else a==="downtemplate"?await H():F(a,{...k})},label:e.props.text})}}function ae(e){const s=e.children.map((r,g)=>({label:r.props.text,index:g,raw:r}));return S(nt,{items:s},{content:({item:r})=>{const g=r.raw;return g?.children?S("div",g.children.map(c=>c.type!="callother"?ge(c):W(c))):S("div","No content")}})}const j=E([String]);function W(e){const s=e.props.otherkey,a=e.props.othertype;if(a==="table"){const r=M.value.find(c=>c.props.key===s);if(!r)return S("div",`Table ${s} not found`);const g={...r,props:{...r.props,isdetail:!1,isexpand:!1}};return j.value.push(s),Ne(g)}return S("div",`Unknown other type: ${a}`)}function de(e){return e?S(rl,{steps:e,saveKey:"wizard-h"},{default:({step:s,schema:a,state:r})=>S("div",a.map(g=>S("div",{class:"mb-3"},[S("label",g.label),S("input",{class:"border p-2 w-full",value:r[g.key],onInput:c=>r[g.key]=c.target.value})])))}):null}function Me(e){return e?S(kt,{container:e,renderChild:ge}):null}function je(e){return e?S($t,{container:e,renderChild:ge,formData:k.value}):null}function ge(e){if(!e)return null;let s=Array.isArray(e)?e:e.children||[];return console.log("comp type",e),S("div",{class:e.props?.class||""},s.map(a=>{switch(a.type){case"table":return Ne(a);case"tabs":return ae(a);case"wizard":return de(a);case"card":return Me(a);case"chart":return je(a);case"master":case"buttons":case"tables":case"columns":case"search":case"widget":case"form":case"cards":case"charts":case"modals":return ge(a);case"action":break;default:return x(a)}}))}function Ae(){let e=!0;return v.value.components?(v.value.components.forEach(s=>{if(["text","password","number","email"].includes(s.type)){const a=k.value[s.key];C(s,a)||(e=!1)}}),e):!0}function Ne(e){if(!e)return null;const s=e.props.key||e.props.text||"table0";if(e.props.isdetail!=!0){let a=function(){for(const c of e.children)c.type==="columns"?r=c:c.type==="search"&&(g=c)},r,g;return a(),S("div",{key:s,class:e.props.class||""},[S(Ve,{ref:f,columns:r?.children.map((c,V)=>({label:c.props.text||`Column ${V+1}`,key:c.props.key||`col${V+1}`,type:c.type||"text"}))??[],searchColumn:g?.children.map((c,V)=>({key:c.props.key||`col${V+1}`,type:c.type||"text",place:c.props.place||"search ..."}))??[],method:"POST",endPoint:e.props.source,simpleSearch:!1,class:e.props.class||"mb-4",rowKey:e.props.primary,enableSearch:!0,tables:M.value,modals:z.value,isSelectAll:e.props.isselectall||!0,isExpand:e.props.isexpand||!1,enableCheck:e.props.enablecheck||!0,onSelectionChange:c=>{i.value=c}})])}return null}function ee(e){let s;v.value.forEach(r=>{r.type=="action"&&(s=r)});const a="on"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();return s.props[a]||null}const Ee=async()=>{const e=ee("read");if(e){const s=new FormData;s.append("flowname",e),s.append("menu","admin"),s.append("search","true");const a=await m.post("admin/execute-flow",s);if(k.value={},a?.data?.data){const r=a?.data?.data;for(const g in r)k.value[g]=r[g]}}},Be=async()=>{const e=ee("create");if(e){const s={...Se(k.value)},a=new FormData;a.append("flowname",e),a.append("menu","admin"),a.append("search","true");for(const g in s){const c=s[g];c!=null&&(typeof c=="object"?a.append(g,JSON.stringify(c)):a.append(g,c))}const r=await m.post("admin/execute-flow",a);r.code==200&&($.add({title:d("TITLE UPDATE"),description:d(r.message.replaceAll("_"," "))}),Ee())}else $.add({title:"Error",description:"Invalid Flow "+e,color:"error"})},qe=async()=>{const e=ee("update");if(e){const s={...Se(k.value)},a=new FormData;a.append("flowname",e),a.append("menu","admin"),a.append("search","true");for(const g in s){const c=s[g];c!=null&&(typeof c=="object"?a.append(g,JSON.stringify(c)):a.append(g,c))}const r=await m.post("admin/execute-flow",a);r.code==200&&$.add({title:d("TITLE UPDATE"),description:d(r.message.replaceAll("_"," "))})}else $.add({title:"Error",description:"Invalid Flow "+e,color:"error"})},We=async()=>{const e=ee("purge");if(e){const s={...Se(k.value)},a=new FormData;a.append("flowname",e),a.append("menu","admin"),a.append("search","true");for(const g in s){const c=s[g];c!=null&&(typeof c=="object"?a.append(g,JSON.stringify(c)):a.append(g,c))}const r=await m.post("admin/execute-flow",a);r.code==200&&$.add({title:d("TITLE DELETE"),description:d(r.message.replaceAll("_"," "))})}else $.add({title:"Error",description:"Invalid Flow "+e,color:"error"})};be(()=>{Ee()});async function He(e){try{let s=function(_){let O=[];return _.forEach(U=>{U.props?.key&&O.push(U.props.key),U.children&&(O=O.concat(s(U.children)))}),O},a="";const r=z.value.find(_=>_.props.key===e),g=r&&e.toLowerCase().includes("detail");if(console.log("saveData debug:",{key:e,isDetailModal:g,modalFound:!!r}),g){let _;v.value.forEach(Y=>{Y.type=="action"&&(_=Y)});const O=z.value.filter(Y=>Y.props.key.toLowerCase().includes("detail")),U=O.findIndex(Y=>Y.props.key===e);console.log("saveData detail debug:",{modalIndex:U,detailModalsCount:O.length}),p.value=="New Data"?a=(_?.props?.onCreateDetail||[])[U]:a=(_?.props?.onUpdateDetail||[])[U]}else p.value=="New Data"?a=ee("create"):a=ee("update");const c=new FormData;c.append("flowname",a),c.append("menu","admin"),c.append("search","true");const V={...Se(k.value)};if(g&&r){const _=s(r.children||[]),O=te();O&&V[O]&&c.append(O,V[O]);for(const U of _){const Y=V[U];Y!=null&&(typeof Y=="object"?c.append(U,JSON.stringify(Y)):typeof Y=="boolean"?c.append(U,Y?"1":"0"):c.append(U,Y))}}else for(const _ in V){const O=V[_];O!=null&&(typeof O=="object"?c.append(_,JSON.stringify(O)):typeof O=="boolean"?c.append(_,O?"1":"0"):c.append(_,O))}const le=await m.post("admin/execute-flow",c);le.code==200?($.add({title:d("TITLE UPDATE"),description:d(le.message.replaceAll("_"," "))}),f.value.refreshTable(),y[e].value=!1):le.code==401&&le.error=="INVALID_TOKEN"&&se("/login")}catch(s){console.error("Gagal simpan data:",s)}}function Fe(e){e.forEach(s=>{s.type==="modals"&&s.children.forEach(a=>{const r=a.props.key;r&&!y[r]&&(y[r]=E(!1))}),s.children?.length&&Fe(s.children)})}return lt(()=>{v.value?.length&&Fe(v.value)}),(e,s)=>(n(),o(q,null,[(n(!0),o(q,null,J(v.value,(a,r)=>(n(),he(xe(ge(a))))),256)),I.value?(n(),o("div",ol,[h("div",{class:"bg-green-500 h-2",style:Ue({width:X.value+"%"})},null,4)])):P("",!0),(n(!0),o(q,null,J(z.value,(a,r)=>(n(),o("div",{key:a.props.key},[u(y)?.[a.props.key]?(n(),he(u(st),{key:0,fullscreen:"",open:u(y)[a.props.key],"onUpdate:open":g=>u(y)[a.props.key]=g,title:p.value,dismissible:!1,description:A.value,scrollable:!1},{body:Ie(()=>[(n(),he(xe(ge(a.children))))]),footer:Ie(()=>[h("div",il,[ve(u(De),{class:"btnSecondary",label:u(d)("CLOSE"),onClick:g=>fe(a.props.key)},null,8,["label","onClick"]),ve(u(De),{class:"btnPrimary",label:u(d)("SAVE"),onClick:g=>He(a.props.key)},null,8,["label","onClick"])])]),_:2},1032,["open","onUpdate:open","title","description"])):P("",!0)]))),128)),h("input",{type:"file",ref_key:"fileInput",ref:D,class:"hidden",onChange:K,accept:".xls,.xlsx"},null,544)],64))}}),yl=Object.assign(ul,{__name:"FormRender"});export{yl as _};
