import{_ as le,j as J,k,n as P,q as E,c as u,a as o,m as R,h as se,F as _,r as C,t as v,l as y,v as g,s as T,o as c,x as ae}from"#entry";const ie={class:"h-screen flex flex-col bg-gray-50"},de={class:"flex items-center justify-between p-4 border-b bg-white"},re={class:"flex items-center gap-2"},ue={class:"flex flex-1 overflow-hidden"},ce={class:"absolute inset-0 pointer-events-none",style:{overflow:"visible"}},pe=["d"],fe=["d"],me=["onDragstart","onDblclick","data-table-id"],ve={class:"flex items-center justify-between p-2 bg-gray-800 text-white rounded-t"},be={class:"font-medium"},xe={class:"flex gap-1"},ye=["onClick"],ge=["onClick"],he={class:"p-2 text-xs"},we=["data-col-index"],ke={class:"w-6 text-gray-600"},_e={class:"flex-1 truncate"},Ce={class:"text-gray-500 text-[11px]"},Ne=["onPointerdown"],Se={class:"absolute left-4 bottom-4"},$e={class:"w-96 border-l bg-white p-4 overflow-auto"},Re={key:0,class:"space-y-4"},Te={class:"text-lg font-semibold"},Oe={class:"flex gap-2 mt-1"},Ae={class:"mt-2 space-y-2"},De=["onUpdate:modelValue"],Je=["onUpdate:modelValue"],Le=["onClick"],je={class:"flex gap-2"},Ue={key:1,class:"text-gray-500"},Pe={class:"mt-2 text-xs bg-gray-50 p-2 border rounded max-h-44 overflow-auto font-mono"},Ee={class:"mt-4"},Be={key:0},Ve={class:"text-sm"},Ie={class:"flex gap-2"},Me=["onClick"],Ye=["onClick"],Fe={key:1,class:"text-gray-400 text-sm"},Xe={__name:"dbobject",setup(qe){let w=1,O=1;const i=J([]),d=J([]),N=k(null),S=k(null),A=k({x:0,y:0}),$=k(null),h=k(""),p=J({active:!1,from:null,sx:0,sy:0,path:""});function B(n=60,e=60){return{id:w++,name:`table_${w-1}`,x:n,y:e,width:220,columns:[{name:"id",type:"int"},{name:"name",type:"varchar"}]}}function D(n,e){i.push(B(n,e))}function V(n){N.value=n;const e=i.find(t=>t.id===n);h.value=e?JSON.stringify(e,null,2):""}const a=P(()=>i.find(n=>n.id===N.value)||null);function I(n,e){S.value=n.id;const t=e.target.getBoundingClientRect();A.value={x:e.clientX-t.left,y:e.clientY-t.top}}function M(n){const e=$.value.getBoundingClientRect();if(!S.value)return;const t=i.find(l=>l.id===S.value);t&&(t.x=n.clientX-e.left-A.value.x,t.y=n.clientY-e.top-A.value.y,S.value=null,x())}function Y(n){const e=i.findIndex(t=>t.id===n);e>=0&&i.splice(e,1);for(let t=d.length-1;t>=0;t--)(d[t].from.table===n||d[t].to.table===n)&&d.splice(t,1)}function F(n){const e=JSON.parse(JSON.stringify(n));e.id=w++,e.x+=20,e.y+=20,e.name=n.name+"_copy",i.push(e),x()}function X(){a.value&&a.value.columns.push({name:"new_col",type:"varchar"})}function q(n){a.value&&a.value.columns.splice(n,1)}function H(){a.value&&(a.value.columns.forEach(n=>{const e=(n.name||"").toLowerCase();e.includes("id")?n.type="int":e.includes("date")||e.includes("at")?n.type="datetime":e.startsWith("is_")||e.startsWith("is")?n.type="boolean":n.type=n.type||"varchar"}),h.value=JSON.stringify(a.value,null,2))}function W(){if(a.value)try{const n=JSON.parse(h.value);a.value.name=n.name||a.value.name,a.value.x=Number(n.x??a.value.x),a.value.y=Number(n.y??a.value.y),a.value.width=Number(n.width??a.value.width),Array.isArray(n.columns)&&(a.value.columns=n.columns),x(),alert("Applied to selected table")}catch{alert("Invalid JSON")}}function z(){navigator.clipboard.writeText(h.value).then(()=>alert("Copied"))}const L=P(()=>JSON.stringify({tables:T(i),relations:T(d)},null,2));function G(){const n=new Blob([L.value],{type:"application/json"}),e=URL.createObjectURL(n),t=document.createElement("a");t.href=e,t.download="design.json",document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(e)}function K(n){const e=n.target.files?.[0];if(!e)return;const t=new FileReader;t.onload=()=>{try{const l=JSON.parse(t.result);l&&Array.isArray(l.tables)?(i.splice(0,i.length,...l.tables.map(s=>({...s}))),d.splice(0,d.length,...Array.isArray(l.relations)?l.relations.map(s=>({...s})):[]),w=Math.max(...i.map(s=>s.id),0)+1,O=Math.max(...d.map(s=>s.id),0)+1,N.value=null,x()):alert("Invalid design file")}catch{alert("Failed to parse file")}},t.readAsText(e),n.target.value=""}function Q(){confirm("Reset design?")&&(i.splice(0,i.length),d.splice(0,d.length),w=1,O=1,N.value=null)}function Z(n,e,t){const l=$.value.getBoundingClientRect(),s=i.find(f=>f.id===n);if(!s)return;const b=s.y+36+e*24;p.active=!0,p.from={table:n,col:e},p.sx=s.x+s.width,p.sy=b,j(t.clientX-l.left,t.clientY-l.top);const m=f=>j(f.clientX-l.left,f.clientY-l.top),r=f=>ee(f,m,r);window.addEventListener("pointermove",m),window.addEventListener("pointerup",r)}function j(n,e){p.path=U(p.sx,p.sy,n,e)}function ee(n,e,t){if(window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",t),!p.active)return;const l=$.value.getBoundingClientRect(),s=n.clientX-l.left,b=n.clientY-l.top;let m=null;for(const r of i)if(s>=r.x&&s<=r.x+r.width&&b>=r.y&&b<=r.y+200){const f=Math.floor((b-(r.y+36))/24);if(f>=0&&f<r.columns.length){m={table:r.id,col:f};break}}if(m){const r={id:O++,from:{table:p.from.table,col:p.from.col,colName:i.find(f=>f.id===p.from.table).columns[p.from.col].name},to:{table:m.table,col:m.col,colName:i.find(f=>f.id===m.table).columns[m.col].name},path:""};d.push(r),x()}p.active=!1,p.path=""}function U(n,e,t,l){const s=(n+t)/2;return`M ${n} ${e} C ${s} ${e} ${s} ${l} ${t} ${l}`}function x(){d.forEach(n=>{const e=i.find(r=>r.id===n.from.table),t=i.find(r=>r.id===n.to.table);if(!e||!t)return;const l=e.y+36+n.from.col*24,s=e.x+e.width,b=t.y+36+n.to.col*24,m=t.x;n.path=U(s,l,m,b)})}function te(n){const e=d.findIndex(t=>t.id===n);e>=0&&d.splice(e,1)}function ne(n){alert("Edit relation not implemented yet")}E(i,x,{deep:!0}),E(d,x,{deep:!0});async function oe(){const n={tables:T(i),relations:T(d)};try{await $fetch("/api/designer/save",{method:"POST",body:n}),alert("Saved to backend")}catch(e){console.error(e),alert("Failed to save to backend")}}return D(40,40),D(320,120),(n,e)=>(c(),u("div",ie,[o("header",de,[e[10]||(e[10]=o("div",{class:"flex items-center gap-3"},[o("h1",{class:"text-xl font-semibold"},"Database Designer — Nuxt + Tailwind"),o("p",{class:"text-sm text-gray-500"},"drag & drop, relasi, import/export JSON, save via API")],-1)),o("div",re,[o("input",{onChange:K,ref:"fileInput",type:"file",accept:"application/json",class:"hidden"},null,544),o("button",{onClick:e[0]||(e[0]=t=>n.$refs.fileInput.click()),class:"px-3 py-1 rounded bg-white border"},"Load JSON"),o("button",{onClick:G,class:"px-3 py-1 rounded bg-blue-600 text-white"},"Download JSON"),o("button",{onClick:oe,class:"px-3 py-1 rounded bg-green-600 text-white"},"Save to Backend"),o("button",{onClick:Q,class:"px-3 py-1 rounded bg-red-500 text-white"},"Reset")])]),o("div",ue,[o("div",{class:"flex-1 relative p-4 bg-gray-100",onDragover:e[2]||(e[2]=R(()=>{},["prevent"])),onDrop:M,ref_key:"canvasRef",ref:$},[(c(),u("svg",ce,[e[11]||(e[11]=o("defs",null,[o("marker",{id:"arrow",markerWidth:"10",markerHeight:"10",refX:"10",refY:"5",orient:"auto"},[o("path",{d:"M0,0 L10,5 L0,10 z",fill:"black"})])],-1)),(c(!0),u(_,null,C(d,t=>(c(),u("g",{key:t.id},[o("path",{d:t.path,stroke:"black","stroke-width":"2",fill:"none","marker-end":"url(#arrow)"},null,8,pe)]))),128)),p.active?(c(),u("path",{key:0,d:p.path,stroke:"gray","stroke-width":"2",fill:"none","stroke-dasharray":"6 4"},null,8,fe)):se("",!0)])),(c(!0),u(_,null,C(i,t=>(c(),u("div",{key:t.id,class:"absolute shadow-lg rounded border bg-white cursor-move",style:ae({left:t.x+"px",top:t.y+"px",width:t.width+"px"}),draggable:"true",onDragstart:l=>I(t,l),onDblclick:l=>V(t.id),"data-table-id":t.id},[o("div",ve,[o("div",be,v(t.name||"table_"+t.id),1),o("div",xe,[o("button",{onClick:R(l=>F(t),["stop"]),title:"Duplicate",class:"text-xs px-2"},"⧉",8,ye),o("button",{onClick:R(l=>Y(t.id),["stop"]),title:"Delete",class:"text-xs px-2"},"✕",8,ge)])]),o("div",he,[(c(!0),u(_,null,C(t.columns,(l,s)=>(c(),u("div",{key:s,class:"flex items-center gap-2","data-col-index":s},[o("span",ke,v(s+1),1),o("span",_e,v(l.name),1),o("span",Ce,v(l.type||""),1),o("button",{onPointerdown:R(b=>Z(t.id,s,b),["stop","prevent"]),class:"w-4 h-4 rounded-full bg-blue-500",title:"Start relation"},null,40,Ne)],8,we))),128))])],44,me))),128)),o("div",Se,[o("button",{onClick:e[1]||(e[1]=t=>D(40,40)),class:"px-3 py-2 rounded bg-green-600 text-white"},"Add Table")])],544),o("aside",$e,[a.value?(c(),u("div",Re,[o("h2",Te,"Properties — "+v(a.value.name||"Untitled"),1),o("div",null,[e[12]||(e[12]=o("label",{class:"text-sm text-gray-600"},"Table Name",-1)),y(o("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.name=t),class:"w-full mt-1 p-2 border rounded"},null,512),[[g,a.value.name]])]),o("div",null,[e[13]||(e[13]=o("label",{class:"text-sm text-gray-600"},"Position",-1)),o("div",Oe,[y(o("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=t=>a.value.x=t),class:"w-1/3 p-2 border rounded"},null,512),[[g,a.value.x,void 0,{number:!0}]]),y(o("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=t=>a.value.y=t),class:"w-1/3 p-2 border rounded"},null,512),[[g,a.value.y,void 0,{number:!0}]]),y(o("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=t=>a.value.width=t),class:"w-1/3 p-2 border rounded"},null,512),[[g,a.value.width,void 0,{number:!0}]])])]),o("div",null,[e[14]||(e[14]=o("label",{class:"text-sm text-gray-600"},"Columns",-1)),o("div",Ae,[(c(!0),u(_,null,C(a.value.columns,(t,l)=>(c(),u("div",{key:l,class:"flex items-center gap-2"},[y(o("input",{"onUpdate:modelValue":s=>t.name=s,placeholder:"name",class:"flex-1 p-2 border rounded"},null,8,De),[[g,t.name]]),y(o("input",{"onUpdate:modelValue":s=>t.type=s,placeholder:"type",class:"w-36 p-2 border rounded"},null,8,Je),[[g,t.type]]),o("button",{onClick:s=>q(l),class:"px-2 py-1 bg-red-500 text-white rounded"},"-",8,Le)]))),128)),o("div",je,[o("button",{onClick:e[7]||(e[7]=t=>X()),class:"px-3 py-1 bg-blue-600 text-white rounded"},"Add Column"),o("button",{onClick:e[8]||(e[8]=t=>H()),class:"px-3 py-1 bg-gray-200 rounded"},"Auto Types")])])]),o("div",null,[e[15]||(e[15]=o("label",{class:"text-sm text-gray-600"},"Raw JSON",-1)),y(o("textarea",{"onUpdate:modelValue":e[9]||(e[9]=t=>h.value=t),rows:"6",class:"w-full p-2 border rounded mt-1 text-xs font-mono"},null,512),[[g,h.value]]),o("div",{class:"flex gap-2 mt-2"},[o("button",{onClick:W,class:"px-3 py-1 bg-green-600 text-white rounded"},"Apply"),o("button",{onClick:z,class:"px-3 py-1 bg-indigo-600 text-white rounded"},"Copy")])])])):(c(),u("div",Ue,[...e[16]||(e[16]=[o("p",null,"Pilih tabel di kanvas (double-click) untuk mengedit properties.",-1),o("p",{class:"mt-2 text-sm"},"Atau gunakan tombol Add Table untuk membuat baru.",-1)])])),e[19]||(e[19]=o("hr",{class:"my-4"},null,-1)),o("div",null,[e[17]||(e[17]=o("h3",{class:"font-semibold"},"Export / Import",-1)),o("pre",Pe,v(L.value),1)]),o("div",Ee,[e[18]||(e[18]=o("h3",{class:"font-semibold"},"Relations",-1)),d.length?(c(),u("div",Be,[(c(!0),u(_,null,C(d,t=>(c(),u("div",{key:t.id,class:"flex items-center justify-between mt-2"},[o("div",Ve,v(t.from.table)+"."+v(t.from.col)+" ➜ "+v(t.to.table)+"."+v(t.to.col??"-"),1),o("div",Ie,[o("button",{onClick:l=>ne(t.id),class:"px-2 py-1 bg-gray-200 rounded"},"Edit",8,Me),o("button",{onClick:l=>te(t.id),class:"px-2 py-1 bg-red-500 text-white rounded"},"Delete",8,Ye)])]))),128))])):(c(),u("div",Fe,"No relations"))])])])]))}},We=le(Xe,[["__scopeId","data-v-62b826b8"]]);export{We as default};
