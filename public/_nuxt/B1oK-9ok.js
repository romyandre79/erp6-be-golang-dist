const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Fv8vSbXv.js","./DirAx5lA.js","./DeaaFGeh.js","./KobTAp13.js","./vendor-drawflow.D47m1JE_.css","./CHaV0QvJ.js","./DQ_kd7ue.js","./entry.BVOpBULD.css","./vendor-icons.Bt8h_iO_.css","./vendor-vue.Bz_NoKHc.css","./CCayPtYg.js","./mra8fcCZ.js","./CoedoqIK.js","./AIHzHQVM.js","./WorkflowSidebar.9B3o4Xu3.css"])))=>i.map(i=>d[i]);
import{_ as F}from"./DQ_kd7ue.js";import{b2 as T,r as l,y as q,z as J,Z as L,w as K,B as Z,a_ as S,am as x,u as O,ak as G,P}from"./DirAx5lA.js";import{u as Q}from"./mra8fcCZ.js";const U=T("workflow",()=>{const u=l(null),h=l([]),v=l([]),s=l([]),w=l([]),c=l([]),m=l(null),g=l([]),_=l(!1),i=Q();async function D(n){_.value=!0;try{const e=new FormData;e.append("flowname","getworkflow"),e.append("menu","admin"),e.append("search","true"),e.append("workflowid",n),e.append("wfname",n);const t=(await i.post("/admin/execute-flow",e))?.data?.data??{},d=t?.flow;if(d&&typeof d=="string")try{t.flow=JSON.parse(d)}catch(R){console.error("Failed parsing flow string",R),t.flow=null}u.value=t;const p=new FormData;p.append("flowname","searchcombocomponentcategory"),p.append("menu","admin"),p.append("search","true");const o=await i.post("/admin/execute-flow",p);h.value=o.data?.data??[];const f=new FormData;f.append("flowname","searchcombocomponent"),f.append("menu","admin"),f.append("search","true");const r=await i.post("/admin/execute-flow",f);v.value=r.data?.data??[];const y=new FormData;y.append("flowname","searchwfparameter"),y.append("menu","admin"),y.append("search","true"),y.append("wfname",n);const W=await i.post("/admin/execute-flow",y);g.value=W.data?.data??[];const b=new FormData;b.append("flowname","searchcomponentdetails"),b.append("menu","admin"),b.append("search","true");const z=await i.post("/admin/execute-flow",b);w.value=z.data?.data??[];const k=new FormData;k.append("flowname","searchwfdetailbywfname"),k.append("menu","admin"),k.append("search","true"),k.append("wfname",n);const H=await i.post("/admin/execute-flow",k);s.value=H.data?.data??[]}finally{_.value=!1}}function j(n){return v.value.find(e=>e.code===n||e.componentname===n||e.name===n)}async function E(n,e){const a=w.value.filter(o=>o.componentname===n),t=s.value.filter(o=>o.componentname===n&&Number(o.nodeid)===Number(e)),d=new Map;t.forEach(o=>{d.set(o.componentdetailid||o.inputname,o)});const p=a.map(o=>{const f=o.componentdetailid||o.inputname,r=d.get(f);return{...o,workflowdetailid:r?.workflowdetailid??0,workflowid:r?.workflowid??0,componentvalue:r?.componentvalue??""}});return c.value=p,p}function M(n,e){return w.value.find(a=>a.componentname===n&&a.inputname===e)||null}function B(n,e,a){return s.value.find(t=>t.componentid===n&&t.componentdetailid===e&&Number(t.nodeid)===Number(a))?.workflowdetailid??""}async function I(n){const e=n?.drawflow?.Home?.data??{};for(const a of Object.values(e)){const t=a?.name,d=a?.data??{};for(const p of Object.keys(d)){const o=M(t,p);if(!o){console.warn("Meta not found:",t,p);continue}const f=B(o.componentid,o.componentdetailid,a.id),r=new FormData;r.append("flowname","modifworkflowdetail"),r.append("menu","admin"),r.append("search","false"),r.append("workflowid",u.value?.workflowid??""),r.append("componentid",o.componentid),r.append("componentdetailid",o.componentdetailid),r.append("workflowdetailid",f||""),r.append("componentvalue",d[p]),r.append("nodeid",a.id),await i.post("/admin/execute-flow",r)}}}async function A(){for(let n=0;n<g.value.length;n++){const e=g.value[n],a=new FormData;a.append("flowname","modifwfparameter"),a.append("menu","admin"),a.append("search","false"),a.append("workflowid",u.value?.workflowid??""),a.append("wfparameterid",e.wfparameterid??""),a.append("parametername",e.parametername??""),a.append("parametervalue",e.parametervalue??""),a.append("parametertype",e.parametertype??""),await i.post("/admin/execute-flow",a)}}async function N(n){_.value=!0;try{const e=new FormData;e.append("flowname","saveflow"),e.append("menu","admin"),e.append("search","false"),e.append("workflowid",u.value?.workflowid??""),e.append("flow",JSON.stringify(n));const a=await i.post("/admin/execute-flow",e);return await I(n),await A(),await D(u.value?.wfname),a}finally{_.value=!1}}function C(n){m.value=n}function V(n){if(!m.value)return;const e=window.editor;if(!e)return;const a=e.drawflow?.drawflow?.Home?.data;if(!a)return;const t=Object.keys(a).find(d=>Number(a[d].id)===Number(m.value.id));t&&(a[t].data={...a[t].data||{},...n},e.drawflow.drawflow.Home.data=a,N(e.export()))}return{workflow:u,categories:h,components:v,componentProperties:c,selectedNode:m,parameters:g,loading:_,loadWorkflow:D,findComponentByName:j,loadComponentProperties:E,saveFlow:N,setSelectedNode:C,updateSelectedNodeData:V}}),X={class:"h-screen flex overflow-hidden"},Y={class:"flex-none bg-white border-r z-10"},$={class:"flex-1 relative bg-gray-100"},ee=q({__name:"[...slug]",setup(u){const h=P(()=>F(()=>import("./Fv8vSbXv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url)),v=P(()=>F(()=>import("./AIHzHQVM.js"),__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,11,12,14]),import.meta.url)),s=L(),w=U();return J(async()=>{const c=s.params.slug??s.params.id??s.query.id;c&&await w.loadWorkflow(c)}),K(()=>s.params.slug,async c=>{const m=c??s.params.id??s.query.id;m&&await w.loadWorkflow(m)}),(c,m)=>(G(),Z("div",X,[S("div",Y,[x(O(v))]),S("div",$,[x(O(h))])]))}}),te=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{te as _,U as u};
